<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0070)https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Language" content="en">

<meta http-equiv="X-UA-Compatible" content="IE=9">
<title>john: run/office2john.py Source File - doxygen documentation | Fossies Dox</title>
<link href="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/jquery.js.下载"></script>
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/dynsections.js.下载"></script>
<link href="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/navtree.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/resize.js.下载"></script>
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/navtreedata.js.下载"></script>
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/navtree.js.下载"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/search.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/searchdata.js.下载"></script>
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/search.js.下载"></script>
<link href="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/doxygen.css" rel="stylesheet" type="text/css">
<script id="navtreeindex55" type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/navtreeindex55.js.下载"></script><script id="files_dup" type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/files_dup.js.下载"></script><script id="dir_a306b7cc5167c29e131a00bfce4c6187" type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/dir_a306b7cc5167c29e131a00bfce4c6187.js.下载"></script><script id="office2john_8py" type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/office2john_8py.js.下载"></script></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">john
   &nbsp;<span id="projectnumber">1.8.0-jumbo-1</span>
   </div>
   <div id="projectbrief">About: <a href="http://www.openwall.com/john/">John</a> is a password cracker (community-enhanced version with more features bu tlower overall quality).<br><img src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/forest1.gif" alt="">&nbsp;&nbsp;<a href="http://fossies.org/" title="Fossies Home">Fossies</a> <a href="http://fossies.org/dox/" title="Fossies: Doxygen Support">Dox</a>: <a href="https://fossies.org/linux/privat/john-1.8.0-jumbo-1.tar.gz/" title="Fossies: john-1.8.0-jumbo-1.tar.gz (contents, browsing &amp; download page)">john-1.8.0-jumbo-1.tar.gz</a> &nbsp;("inofficial" and yet experimental doxygen-generated source code documentation)&nbsp;&nbsp;<img src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/forest2.gif" alt=""><p></p></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/menudata.js.下载"></script>
<script type="text/javascript" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/menu.js.下载"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"><ul class="sm sm-dox" id="main-menu" data-smartmenus-id="15298450964667957"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/index.html">Main Page</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/pages.html">Related Pages</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/modules.html">Modules</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaces.html" class="has-submenu" id="sm-15298450964667957-1" aria-haspopup="true" aria-controls="sm-15298450964667957-2" aria-expanded="false"><span class="sub-arrow">+</span>Namespaces</a><ul id="sm-15298450964667957-2" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-1" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaces.html">Namespace List</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers.html" class="has-submenu" id="sm-15298450964667957-3" aria-haspopup="true" aria-controls="sm-15298450964667957-4" aria-expanded="false"><span class="sub-arrow">+</span>Namespace Members</a><ul id="sm-15298450964667957-4" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-3" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers.html" class="has-submenu" id="sm-15298450964667957-5" aria-haspopup="true" aria-controls="sm-15298450964667957-6" aria-expanded="false"><span class="sub-arrow">+</span>All</a><ul id="sm-15298450964667957-6" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-5" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html" class="has-submenu" id="sm-15298450964667957-7" aria-haspopup="true" aria-controls="sm-15298450964667957-8" aria-expanded="false"><span class="sub-arrow">+</span>Functions</a><ul id="sm-15298450964667957-8" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-7" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_func.html#index_w">w</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars.html" class="has-submenu" id="sm-15298450964667957-9" aria-haspopup="true" aria-controls="sm-15298450964667957-10" aria-expanded="false"><span class="sub-arrow">+</span>Variables</a><ul id="sm-15298450964667957-10" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-9" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespacemembers_vars_z.html#index_z">z</a></li></ul></li></ul></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/annotated.html" class="has-submenu" id="sm-15298450964667957-11" aria-haspopup="true" aria-controls="sm-15298450964667957-12" aria-expanded="false"><span class="sub-arrow">+</span>Data Structures</a><ul id="sm-15298450964667957-12" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-11" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/annotated.html">Data Structures</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classes.html">Data Structure Index</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/inherits.html">Class Hierarchy</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions.html" class="has-submenu" id="sm-15298450964667957-13" aria-haspopup="true" aria-controls="sm-15298450964667957-14" aria-expanded="false"><span class="sub-arrow">+</span>Data Fields</a><ul id="sm-15298450964667957-14" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-13" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions.html" class="has-submenu" id="sm-15298450964667957-15" aria-haspopup="true" aria-controls="sm-15298450964667957-16" aria-expanded="false"><span class="sub-arrow">+</span>All</a><ul id="sm-15298450964667957-16" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-15" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions.html#index_0x24">$</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions__.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_y.html#index_y">y</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func.html" class="has-submenu" id="sm-15298450964667957-17" aria-haspopup="true" aria-controls="sm-15298450964667957-18" aria-expanded="false"><span class="sub-arrow">+</span>Functions</a><ul id="sm-15298450964667957-18" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-17" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_func_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars.html" class="has-submenu" id="sm-15298450964667957-19" aria-haspopup="true" aria-controls="sm-15298450964667957-20" aria-expanded="false"><span class="sub-arrow">+</span>Variables</a><ul id="sm-15298450964667957-20" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-19" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars.html#index_0x24">$</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars__.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_y.html#index_y">y</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_vars_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/functions_prop.html">Properties</a></li></ul></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/files.html" class="has-submenu" id="sm-15298450964667957-21" aria-haspopup="true" aria-controls="sm-15298450964667957-22" aria-expanded="false"><span class="sub-arrow">+</span>Files</a><ul id="sm-15298450964667957-22" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-21" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/files.html">File List</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals.html" class="has-submenu" id="sm-15298450964667957-23" aria-haspopup="true" aria-controls="sm-15298450964667957-24" aria-expanded="false"><span class="sub-arrow">+</span>Globals</a><ul id="sm-15298450964667957-24" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-23" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals.html" class="has-submenu" id="sm-15298450964667957-25" aria-haspopup="true" aria-controls="sm-15298450964667957-26" aria-expanded="false"><span class="sub-arrow">+</span>All</a><ul id="sm-15298450964667957-26" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-25" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_y.html#index_y">y</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func.html" class="has-submenu" id="sm-15298450964667957-27" aria-haspopup="true" aria-controls="sm-15298450964667957-28" aria-expanded="false"><span class="sub-arrow">+</span>Functions</a><ul id="sm-15298450964667957-28" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-27" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_func_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars.html" class="has-submenu" id="sm-15298450964667957-29" aria-haspopup="true" aria-controls="sm-15298450964667957-30" aria-expanded="false"><span class="sub-arrow">+</span>Variables</a><ul id="sm-15298450964667957-30" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-29" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_y.html#index_y">y</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_vars_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type.html" class="has-submenu" id="sm-15298450964667957-31" aria-haspopup="true" aria-controls="sm-15298450964667957-32" aria-expanded="false"><span class="sub-arrow">+</span>Typedefs</a><ul id="sm-15298450964667957-32" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-31" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_type_z.html#index_z">z</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_enum.html">Enumerations</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval.html" class="has-submenu" id="sm-15298450964667957-33" aria-haspopup="true" aria-controls="sm-15298450964667957-34" aria-expanded="false"><span class="sub-arrow">+</span>Enumerator</a><ul id="sm-15298450964667957-34" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-33" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_eval_v.html#index_v">v</a></li></ul></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs.html" class="has-submenu" id="sm-15298450964667957-35" aria-haspopup="true" aria-controls="sm-15298450964667957-36" aria-expanded="false"><span class="sub-arrow">+</span>Macros</a><ul id="sm-15298450964667957-36" role="group" aria-hidden="true" aria-labelledby="sm-15298450964667957-35" aria-expanded="false"><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs.html#index__">_</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_a.html#index_a">a</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_b.html#index_b">b</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_c.html#index_c">c</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_d.html#index_d">d</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_e.html#index_e">e</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_f.html#index_f">f</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_g.html#index_g">g</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_h.html#index_h">h</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_i.html#index_i">i</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_j.html#index_j">j</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_k.html#index_k">k</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_l.html#index_l">l</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_m.html#index_m">m</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_n.html#index_n">n</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_o.html#index_o">o</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_p.html#index_p">p</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_q.html#index_q">q</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_r.html#index_r">r</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_s.html#index_s">s</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_t.html#index_t">t</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_u.html#index_u">u</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_v.html#index_v">v</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_w.html#index_w">w</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_x.html#index_x">x</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_y.html#index_y">y</a></li><li><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals_defs_z.html#index_z">z</a></li></ul></li></ul></li></ul></li><li style="float:right"><div id="MSearchBox" class="MSearchBoxInactive"><span class="left"><img id="MSearchSelect" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/mag_sel.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt=""><input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)"></span><span class="right"><a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/close.png" alt=""></a></span></div></li></ul></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable" style="height: 397px;">
  <div id="nav-tree" style="height: 397px;">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync" style="top: 5px;"><img src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/sync_on.png" title="click to disable panel synchronisation"></div>
    <ul style="display: block;"><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 0px;">▼</span></a><span class="label"><a class="index.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/index.html">john</a></span></div><ul class="children_ul" style="display: block;"><li><div class="item"><span class="arrow" style="width: 32px;">&nbsp;</span><span class="label"><a class="md_doc_Kerberos-Auditing-HOWTO.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/md_doc_Kerberos-Auditing-HOWTO.html">Auditing Kerberos Hashes</a></span></div></li><li><div class="item"><span class="arrow" style="width: 32px;">&nbsp;</span><span class="label"><a class="md_doc_SecureMode-tutorial.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/md_doc_SecureMode-tutorial.html">SecureMode</a></span></div></li><li><div class="item"><span class="arrow" style="width: 32px;">&nbsp;</span><span class="label"><a class="deprecated.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/deprecated.html">Deprecated List</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 16px;">►</span></a><span class="label"><a class="modules.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/modules.html">Modules</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 16px;">►</span></a><span class="label"><a class="namespaces.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaces.html">Namespaces</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 16px;">►</span></a><span class="label"><a class="annotated.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/annotated.html">Data Structures</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 16px;">▼</span></a><span class="label"><a class="files.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/files.html">Files</a></span></div><ul class="children_ul" style="display: block;"><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 32px;">▼</span></a><span class="label"><a class="files.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/files.html">File List</a></span></div><ul class="children_ul" style="display: block;"><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 48px;">▼</span></a><span class="label"><a class="dir_a306b7cc5167c29e131a00bfce4c6187.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/dir_a306b7cc5167c29e131a00bfce4c6187.html">run</a></span></div><ul class="children_ul" style="display: block;"><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="1password2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/1password2john_8py.html">1password2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="7z2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/7z2john_8py.html">7z2john.py</a></span></div></li><li><div class="item"><span class="arrow" style="width: 80px;">&nbsp;</span><span class="label"><a class="aix2john_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/aix2john_8pl.html">aix2john.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="aix2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/aix2john_8py.html">aix2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="androidfde2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/androidfde2john_8py.html">androidfde2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="apex2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/apex2john_8py.html">apex2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="bitcoin2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/bitcoin2john_8py.html">bitcoin2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="blockchain2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/blockchain2john_8py.html">blockchain2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="cisco2john_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/cisco2john_8pl.html">cisco2john.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="cracf2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/cracf2john_8py.html">cracf2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="dmg2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/dmg2john_8py.html">dmg2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="ecryptfs2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/ecryptfs2john_8py.html">ecryptfs2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="efs2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/efs2john_8py.html">efs2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="encfs2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/encfs2john_8py.html">encfs2john.py</a></span></div></li><li><div class="item"><span class="arrow" style="width: 80px;">&nbsp;</span><span class="label"><a class="hextoraw_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/hextoraw_8pl.html">hextoraw.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="htdigest2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/htdigest2john_8py.html">htdigest2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="ikescan2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/ikescan2john_8py.html">ikescan2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="ios7tojohn_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/ios7tojohn_8pl.html">ios7tojohn.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="kdcdump2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/kdcdump2john_8py.html">kdcdump2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="keychain2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/keychain2john_8py.html">keychain2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="keystore2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/keystore2john_8py.html">keystore2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="known__hosts2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/known__hosts2john_8py.html">known_hosts2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="kwallet2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/kwallet2john_8py.html">kwallet2john.py</a></span></div></li><li><div class="item"><span class="arrow" style="width: 80px;">&nbsp;</span><span class="label"><a class="ldif2john_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/ldif2john_8pl.html">ldif2john.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="leet_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/leet_8pl.html">leet.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="lion2john-alt_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/lion2john-alt_8pl.html">lion2john-alt.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="lion2john_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/lion2john_8pl.html">lion2john.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="lotus2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/lotus2john_8py.html">lotus2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="mcafee__epo2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/mcafee__epo2john_8py.html">mcafee_epo2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="ml2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/ml2john_8py.html">ml2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="mozilla2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/mozilla2john_8py.html">mozilla2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="netntlm_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/netntlm_8pl.html">netntlm.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="netscreen_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/netscreen_8py.html">netscreen.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="odf2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/odf2john_8py.html">odf2john.py</a></span></div></li><li><div class="item selected" id="selected"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="office2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py.html">office2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="openbsd__softraid2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/openbsd__softraid2john_8py.html">openbsd_softraid2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="openssl2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/openssl2john_8py.html">openssl2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="pass__gen_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/pass__gen_8pl.html">pass_gen.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="pcap2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/pcap2john_8py.html">pcap2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="pdf2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/pdf2john_8py.html">pdf2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="radius2john_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/radius2john_8pl.html">radius2john.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="rexgen2rules_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/rexgen2rules_8pl.html">rexgen2rules.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="sap2john_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/sap2john_8pl.html">sap2john.pl</a></span></div></li><li><div class="item"><span class="arrow" style="width: 80px;">&nbsp;</span><span class="label"><a class="sha-dump_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/sha-dump_8pl.html">sha-dump.pl</a></span></div></li><li><div class="item"><span class="arrow" style="width: 80px;">&nbsp;</span><span class="label"><a class="sha-test_8pl.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/sha-test_8pl.html">sha-test.pl</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="sipdump2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/sipdump2john_8py.html">sipdump2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="ssh2sshng_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/ssh2sshng_8py.html">ssh2sshng.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="sshng2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/sshng2john_8py.html">sshng2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="strip2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/strip2john_8py.html">strip2john.py</a></span></div></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 64px;">►</span></a><span class="label"><a class="sxc2john_8py.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/sxc2john_8py.html">sxc2john.py</a></span></div></li></ul></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 48px;">►</span></a><span class="label"><a class="dir_68267d1309a1af8e8297ef4c3efbcdba.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></span></div></li></ul></li><li><div class="item"><a href="javascript:void(0)"><span class="arrow" style="padding-left: 32px;">►</span></a><span class="label"><a class="globals.html" href="https://fossies.org/dox/john-1.8.0-jumbo-1/globals.html">Globals</a></span></div></li></ul></li></ul></li></ul></div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" class="ui-resizable-handle">
  </div>
<div class="ui-resizable-handle ui-resizable-e"></div><div class="ui-resizable-handle ui-resizable-s"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 1001;"></div></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('office2john_8py_source.html','');});
/* @license-end */
</script>
<div id="doc-content" style="margin-left: 256px; height: 397px;">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" onclick="searchBox.OnSelectItem(0)" href="javascript:void(0)"><span class="SelectionMark">•</span>All</a><a class="SelectItem" onclick="searchBox.OnSelectItem(1)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" onclick="searchBox.OnSelectItem(2)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" onclick="searchBox.OnSelectItem(3)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" onclick="searchBox.OnSelectItem(4)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" onclick="searchBox.OnSelectItem(5)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" onclick="searchBox.OnSelectItem(6)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" onclick="searchBox.OnSelectItem(7)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" onclick="searchBox.OnSelectItem(8)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" onclick="searchBox.OnSelectItem(9)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Properties</a><a class="SelectItem" onclick="searchBox.OnSelectItem(10)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Macros</a><a class="SelectItem" onclick="searchBox.OnSelectItem(11)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Modules</a><a class="SelectItem" onclick="searchBox.OnSelectItem(12)" href="javascript:void(0)"><span class="SelectionMark">&nbsp;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" name="MSearchResults" id="MSearchResults" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/saved_resource.html">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">office2john.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html">    1</a></span>&nbsp;<span class="comment">#!/usr/bin/env python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&nbsp;<span class="comment"># -*- coding: latin-1 -*-</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&nbsp;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&nbsp;<span class="comment"># This software is Copyright (c) 2012-2013 Dhiru Kholia &lt;dhiru at openwall.com&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&nbsp;<span class="comment"># and is licensed under the same license as used by the OleFileIO_PL library,</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&nbsp;<span class="comment"># which is included below.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&nbsp;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&nbsp;<span class="stringliteral">"""</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&nbsp;<span class="stringliteral">OleFileIO_PL:</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&nbsp;<span class="stringliteral">    Module to read Microsoft OLE2 files (also called Structured Storage or</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&nbsp;<span class="stringliteral">    Microsoft Compound Document File Format), such as Microsoft Office</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&nbsp;<span class="stringliteral">    documents, Image Composer and FlashPix files, Outlook messages, ...</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&nbsp;<span class="stringliteral">version 0.23 2012-07-25 Philippe Lagadec - http://www.decalage.info</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&nbsp;<span class="stringliteral">Project website: http://www.decalage.info/python/olefileio</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&nbsp;<span class="stringliteral">Improved version of the OleFileIO module from PIL library v1.1.6</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&nbsp;<span class="stringliteral">See: http://www.pythonware.com/products/pil/index.htm</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&nbsp;<span class="stringliteral">The Python Imaging Library (PIL) is</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&nbsp;<span class="stringliteral">    Copyright (c) 1997-2005 by Secret Labs AB</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&nbsp;<span class="stringliteral">    Copyright (c) 1995-2005 by Fredrik Lundh</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&nbsp;<span class="stringliteral">OleFileIO_PL changes are Copyright (c) 2005-2012 by Philippe Lagadec</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&nbsp;<span class="stringliteral">See source code and LICENSE.txt for information on usage and redistribution.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&nbsp;<span class="stringliteral">WARNING: THIS IS (STILL) WORK IN PROGRESS.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&nbsp;<span class="stringliteral">"""</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&nbsp;</div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac4182fa618b25a8230e5f702cca1c8c9">   31</a></span>&nbsp;__author__  = <span class="stringliteral">"Fredrik Lundh (Secret Labs AB), Philippe Lagadec"</span></div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2ca034176549293d4c131eb5d811e52d">   32</a></span>&nbsp;__date__    = <span class="stringliteral">"2012-07-25"</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a275923ebdfeb4e4accd9d361cd5f2723">   33</a></span>&nbsp;__version__ = <span class="stringliteral">'0.23'</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&nbsp;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&nbsp;<span class="comment">#--- LICENSE ------------------------------------------------------------------</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&nbsp;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&nbsp;<span class="comment"># OleFileIO_PL is an improved version of the OleFileIO module from the</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&nbsp;<span class="comment"># Python Imaging Library (PIL).</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&nbsp;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&nbsp;<span class="comment"># OleFileIO_PL changes are Copyright (c) 2005-2012 by Philippe Lagadec</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&nbsp;<span class="comment"># The Python Imaging Library (PIL) is</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&nbsp;<span class="comment">#    Copyright (c) 1997-2005 by Secret Labs AB</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&nbsp;<span class="comment">#    Copyright (c) 1995-2005 by Fredrik Lundh</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&nbsp;<span class="comment"># By obtaining, using, and/or copying this software and/or its associated</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&nbsp;<span class="comment"># documentation, you agree that you have read, understood, and will comply with</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&nbsp;<span class="comment"># the following terms and conditions:</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&nbsp;<span class="comment"># Permission to use, copy, modify, and distribute this software and its</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&nbsp;<span class="comment"># associated documentation for any purpose and without fee is hereby granted,</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&nbsp;<span class="comment"># provided that the above copyright notice appears in all copies, and that both</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&nbsp;<span class="comment"># that copyright notice and this permission notice appear in supporting</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&nbsp;<span class="comment"># documentation, and that the name of Secret Labs AB or the author(s) not be used</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&nbsp;<span class="comment"># in advertising or publicity pertaining to distribution of the software</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&nbsp;<span class="comment"># without specific, written prior permission.</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&nbsp;<span class="comment"># SECRET LABS AB AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&nbsp;<span class="comment"># SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&nbsp;<span class="comment"># IN NO EVENT SHALL SECRET LABS AB OR THE AUTHORS BE LIABLE FOR ANY SPECIAL,</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&nbsp;<span class="comment"># INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&nbsp;<span class="comment"># LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&nbsp;<span class="comment"># OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&nbsp;<span class="comment"># PERFORMANCE OF THIS SOFTWARE.</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&nbsp;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&nbsp;<span class="comment">#-----------------------------------------------------------------------------</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&nbsp;<span class="comment"># CHANGELOG: (only OleFileIO_PL changes compared to PIL 1.1.6)</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&nbsp;<span class="comment"># 2005-05-11 v0.10 PL: - a few fixes for Python 2.4 compatibility</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&nbsp;<span class="comment">#                        (all changes flagged with [PL])</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&nbsp;<span class="comment"># 2006-02-22 v0.11 PL: - a few fixes for some Office 2003 documents which raise</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&nbsp;<span class="comment">#                        exceptions in _OleStream.__init__()</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&nbsp;<span class="comment"># 2006-06-09 v0.12 PL: - fixes for files above 6.8MB (DIFAT in loadfat)</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&nbsp;<span class="comment">#                      - added some constants</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&nbsp;<span class="comment">#                      - added header values checks</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&nbsp;<span class="comment">#                      - added some docstrings</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&nbsp;<span class="comment">#                      - getsect: bugfix in case sectors &gt;512 bytes</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&nbsp;<span class="comment">#                      - getsect: added conformity checks</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&nbsp;<span class="comment">#                      - DEBUG_MODE constant to activate debug display</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&nbsp;<span class="comment"># 2007-09-04 v0.13 PL: - improved/translated (lots of) comments</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&nbsp;<span class="comment">#                      - updated license</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&nbsp;<span class="comment">#                      - converted tabs to 4 spaces</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&nbsp;<span class="comment"># 2007-11-19 v0.14 PL: - added OleFileIO._raise_defect() to adapt sensitivity</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&nbsp;<span class="comment">#                      - improved _unicode() to use Python 2.x unicode support</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&nbsp;<span class="comment">#                      - fixed bug in _OleDirectoryEntry</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&nbsp;<span class="comment"># 2007-11-25 v0.15 PL: - added safety checks to detect FAT loops</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&nbsp;<span class="comment">#                      - fixed _OleStream which didn't check stream size</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&nbsp;<span class="comment">#                      - added/improved many docstrings and comments</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&nbsp;<span class="comment">#                      - moved helper functions _unicode and _clsid out of</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&nbsp;<span class="comment">#                        OleFileIO class</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&nbsp;<span class="comment">#                      - improved OleFileIO._find() to add Unix path syntax</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&nbsp;<span class="comment">#                      - OleFileIO._find() is now case-insensitive</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&nbsp;<span class="comment">#                      - added get_type() and get_rootentry_name()</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&nbsp;<span class="comment">#                      - rewritten loaddirectory and _OleDirectoryEntry</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&nbsp;<span class="comment"># 2007-11-27 v0.16 PL: - added _OleDirectoryEntry.kids_dict</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&nbsp;<span class="comment">#                      - added detection of duplicate filenames in storages</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&nbsp;<span class="comment">#                      - added detection of duplicate references to streams</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&nbsp;<span class="comment">#                      - added get_size() and exists() to _OleDirectoryEntry</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&nbsp;<span class="comment">#                      - added isOleFile to check header before parsing</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&nbsp;<span class="comment">#                      - added __all__ list to control public keywords in pydoc</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&nbsp;<span class="comment"># 2007-12-04 v0.17 PL: - added _load_direntry to fix a bug in loaddirectory</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&nbsp;<span class="comment">#                      - improved _unicode(), added workarounds for Python &lt;2.3</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&nbsp;<span class="comment">#                      - added set_debug_mode and -d option to set debug mode</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&nbsp;<span class="comment">#                      - fixed bugs in OleFileIO.open and _OleDirectoryEntry</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&nbsp;<span class="comment">#                      - added safety check in main for large or binary</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&nbsp;<span class="comment">#                        properties</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&nbsp;<span class="comment">#                      - allow size&gt;0 for storages for some implementations</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&nbsp;<span class="comment"># 2007-12-05 v0.18 PL: - fixed several bugs in handling of FAT, MiniFAT and</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&nbsp;<span class="comment">#                        streams</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&nbsp;<span class="comment">#                      - added option '-c' in main to check all streams</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&nbsp;<span class="comment"># 2009-12-10 v0.19 PL: - bugfix for 32 bit arrays on 64 bits platforms</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&nbsp;<span class="comment">#                        (thanks to Ben G. and Martijn for reporting the bug)</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&nbsp;<span class="comment"># 2009-12-11 v0.20 PL: - bugfix in OleFileIO.open when filename is not plain str</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&nbsp;<span class="comment"># 2010-01-22 v0.21 PL: - added support for big-endian CPUs such as PowerPC Macs</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&nbsp;<span class="comment"># 2012-02-16 v0.22 PL: - fixed bug in getproperties, patch by chuckleberryfinn</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&nbsp;<span class="comment">#                        (https://bitbucket.org/decalage/olefileio_pl/issue/7)</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&nbsp;<span class="comment">#                      - added close method to OleFileIO (fixed issue #2)</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&nbsp;<span class="comment"># 2012-07-25 v0.23 PL: - added support for file-like objects (patch by mete0r_kr)</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&nbsp;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&nbsp;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&nbsp;<span class="comment">#-----------------------------------------------------------------------------</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&nbsp;<span class="comment"># TODO (for version 1.0):</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&nbsp;<span class="comment"># - TESTS with Linux, MacOSX, Python 1.5.2, various files, PIL, ...</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&nbsp;<span class="comment"># - add underscore to each private method, to avoid their display in</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&nbsp;<span class="comment">#   pydoc/epydoc documentation</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&nbsp;<span class="comment"># - replace all raised exceptions with _raise_defect (at least in OleFileIO)</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&nbsp;<span class="comment"># - merge code from _OleStream and OleFileIO.getsect to read sectors</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&nbsp;<span class="comment">#   (maybe add a class for FAT and MiniFAT ?)</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&nbsp;<span class="comment"># - add method to check all streams (follow sectors chains without storing all</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&nbsp;<span class="comment">#   stream in memory, and report anomalies)</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&nbsp;<span class="comment"># - use _OleDirectoryEntry.kids_dict to improve _find and _list ?</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&nbsp;<span class="comment"># - fix Unicode names handling (find some way to stay compatible with Py1.5.2)</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&nbsp;<span class="comment">#   =&gt; if possible avoid converting names to Latin-1</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&nbsp;<span class="comment"># - review DIFAT code: fix handling of DIFSECT blocks in FAT (not stop)</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&nbsp;<span class="comment"># - rewrite OleFileIO.getproperties</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&nbsp;<span class="comment"># - improve docstrings to show more sample uses</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&nbsp;<span class="comment"># - see also original notes and FIXME below</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&nbsp;<span class="comment"># - remove all obsolete FIXMEs</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&nbsp;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&nbsp;<span class="comment"># IDEAS:</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&nbsp;<span class="comment"># - allow _raise_defect to raise different exceptions, not only IOError</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&nbsp;<span class="comment"># - provide a class with named attributes to get well-known properties of</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&nbsp;<span class="comment">#   MS Office documents (title, author, ...) ?</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&nbsp;<span class="comment"># - in OleFileIO._open and _OleStream, use size=None instead of 0x7FFFFFFF for</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&nbsp;<span class="comment">#   streams with unknown size</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&nbsp;<span class="comment"># - use arrays of int instead of long integers for FAT/MiniFAT, to improve</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&nbsp;<span class="comment">#   performance and reduce memory usage ? (possible issue with values &gt;2^31)</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&nbsp;<span class="comment"># - provide tests with unittest (may need write support to create samples)</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&nbsp;<span class="comment"># - move all debug code (and maybe dump methods) to a separate module, with</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&nbsp;<span class="comment">#   a class which inherits OleFileIO ?</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&nbsp;<span class="comment"># - fix docstrings to follow epydoc format</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&nbsp;<span class="comment"># - add support for 4K sectors ?</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&nbsp;<span class="comment"># - add support for big endian byte order ?</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&nbsp;<span class="comment"># - create a simple OLE explorer with wxPython</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&nbsp;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&nbsp;<span class="comment"># FUTURE EVOLUTIONS to add write support:</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&nbsp;<span class="comment"># 1) add ability to write a stream back on disk from StringIO (same size, no</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&nbsp;<span class="comment">#    change in FAT/MiniFAT).</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&nbsp;<span class="comment"># 2) rename a stream/storage if it doesn't change the RB tree</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&nbsp;<span class="comment"># 3) use rbtree module to update the red-black tree + any rename</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&nbsp;<span class="comment"># 4) remove a stream/storage: free sectors in FAT/MiniFAT</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&nbsp;<span class="comment"># 5) allocate new sectors in FAT/MiniFAT</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&nbsp;<span class="comment"># 6) create new storage/stream</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&nbsp;<span class="comment">#-----------------------------------------------------------------------------</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&nbsp;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&nbsp;<span class="comment"># THIS IS WORK IN PROGRESS</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&nbsp;<span class="comment"># The Python Imaging Library</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&nbsp;<span class="comment"># $Id: OleFileIO.py 2339 2005-03-25 08:02:17Z fredrik $</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&nbsp;<span class="comment"># stuff to deal with OLE2 Structured Storage files.  this module is</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&nbsp;<span class="comment"># used by PIL to read Image Composer and FlashPix files, but can also</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&nbsp;<span class="comment"># be used to read other files of this type.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&nbsp;<span class="comment"># History:</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&nbsp;<span class="comment"># 1997-01-20 fl   Created</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&nbsp;<span class="comment"># 1997-01-22 fl   Fixed 64-bit portability quirk</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&nbsp;<span class="comment"># 2003-09-09 fl   Fixed typo in OleFileIO.loadfat (noted by Daniel Haertle)</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&nbsp;<span class="comment"># 2004-02-29 fl   Changed long hex constants to signed integers</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&nbsp;<span class="comment"># Notes:</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&nbsp;<span class="comment"># FIXME: sort out sign problem (eliminate long hex constants)</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&nbsp;<span class="comment"># FIXME: change filename to use "a/b/c" instead of ["a", "b", "c"]</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&nbsp;<span class="comment"># FIXME: provide a glob mechanism function (using fnmatchcase)</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&nbsp;<span class="comment"># Literature:</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&nbsp;<span class="comment"># "FlashPix Format Specification, Appendix A", Kodak and Microsoft,</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&nbsp;<span class="comment">#  September 1996.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&nbsp;<span class="comment"># Quotes:</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&nbsp;<span class="comment"># "If this document and functionality of the Software conflict,</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&nbsp;<span class="comment">#  the actual functionality of the Software represents the correct</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&nbsp;<span class="comment">#  functionality" -- Microsoft, in the OLE format specification</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&nbsp;<span class="comment"># Copyright (c) Secret Labs AB 1997.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&nbsp;<span class="comment"># Copyright (c) Fredrik Lundh 1997.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&nbsp;<span class="comment"># See the README file for information on usage and redistribution.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&nbsp;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&nbsp;<span class="comment">#------------------------------------------------------------------------------</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&nbsp;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&nbsp;<span class="keyword">import</span> struct, array, os.path, sys</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&nbsp;</div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#afd17c445566e73f724cbe401ba0331ea">  207</a></span>&nbsp;PY3 = sys.version_info[0] == 3</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&nbsp;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&nbsp;<span class="keywordflow">if</span> <span class="keywordflow">not</span> PY3:</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&nbsp;    reload(sys)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&nbsp;    sys.setdefaultencoding(<span class="stringliteral">"utf8"</span>)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&nbsp;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&nbsp;<span class="keywordflow">if</span> PY3:</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&nbsp;    <span class="keyword">from</span> io <span class="keyword">import</span> BytesIO <span class="keyword">as</span> StringIO</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&nbsp;<span class="keywordflow">else</span>:</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&nbsp;    <span class="keyword">from</span> StringIO <span class="keyword">import</span> StringIO</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&nbsp;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&nbsp;<span class="comment">#[PL] Define explicitly the public API to avoid private objects in pydoc:</span></div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a563dda556d00b05aac77e67724ca7e60">  219</a></span>&nbsp;__all__ = [<span class="stringliteral">'OleFileIO'</span>, <span class="stringliteral">'isOleFile'</span>]</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&nbsp;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&nbsp;<span class="comment">#[PL] workaround to fix an issue with array item size on 64 bits systems:</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&nbsp;<span class="keywordflow">if</span> array.array(<span class="stringliteral">'L'</span>).itemsize == 4:</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&nbsp;    <span class="comment"># on 32 bits platforms, long integers in an array are 32 bits:</span></div><div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2848826b33caa6f8e6a47b7f1cbf8fd8">  224</a></span>&nbsp;    UINT32 = <span class="stringliteral">'L'</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&nbsp;<span class="keywordflow">elif</span> array.array(<span class="stringliteral">'I'</span>).itemsize == 4:</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&nbsp;    <span class="comment"># on 64 bits platforms, integers in an array are 32 bits:</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&nbsp;    UINT32 = <span class="stringliteral">'I'</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&nbsp;<span class="keywordflow">else</span>:</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&nbsp;    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">'Need to fix a bug with 32 bit arrays, please contact author...'</span>)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&nbsp;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&nbsp;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&nbsp;<span class="comment">#[PL] These workarounds were inspired from the Path module</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&nbsp;<span class="comment"># (see http://www.jorendorff.com/articles/python/path/)</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&nbsp;<span class="comment">#TODO: test with old Python versions</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&nbsp;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&nbsp;<span class="comment">#[PL] Experimental setting: if True, OLE filenames will be kept in Unicode</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&nbsp;<span class="comment"># if False (default PIL behaviour), all filenames are converted to Latin-1.</span></div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a1c8cbb6f09271e2c31f5fdf298c08994">  238</a></span>&nbsp;KEEP_UNICODE_NAMES = <span class="keyword">True</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&nbsp;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&nbsp;<span class="comment">#[PL] DEBUG display mode: False by default, use set_debug_mode() or "-d" on</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&nbsp;<span class="comment"># command line to change it.</span></div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a0194addd1d0c34d6406f2dee0e1921e6">  242</a></span>&nbsp;DEBUG_MODE = <span class="keyword">False</span></div><div class="line"><a name="l00243"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af0b16284c9edeff57927a705694d76f7">  243</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af0b16284c9edeff57927a705694d76f7">debug_print</a>(msg):</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&nbsp;    print(msg)</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a9eb650a66fda280eefaec5cc01e7ea10">  245</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a9eb650a66fda280eefaec5cc01e7ea10">debug_pass</a>(msg):</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&nbsp;    <span class="keywordflow">pass</span></div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">  247</a></span>&nbsp;debug = debug_pass</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&nbsp;</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#afc1397de1a90cd05b5ef70694cf6c4d0">  249</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#afc1397de1a90cd05b5ef70694cf6c4d0">set_debug_mode</a>(debug_mode):</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&nbsp;<span class="stringliteral">    Set debug mode on or off, to control display of debugging messages.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&nbsp;<span class="stringliteral">    mode: True or False</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&nbsp;    <span class="keyword">global</span> DEBUG_MODE, debug</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&nbsp;    DEBUG_MODE = debug_mode</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&nbsp;    <span class="keywordflow">if</span> debug_mode:</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&nbsp;        debug = debug_print</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&nbsp;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&nbsp;        debug = debug_pass</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&nbsp;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&nbsp;<span class="comment">#TODO: convert this to hex</span></div><div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2d8ca1b5f54cb7a1f0a17d272618da4d">  262</a></span>&nbsp;MAGIC = b<span class="stringliteral">'\320\317\021\340\241\261\032\341'</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&nbsp;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&nbsp;<span class="comment">#[PL]: added constants for Sector IDs (from AAF specifications)</span></div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af6ff3ab43c4259036dd1eb8019f4a523">  265</a></span>&nbsp;MAXREGSECT = 0xFFFFFFFA; <span class="comment"># maximum SECT</span></div><div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#afc0658797d23693ecf0ed71cc6f1e5ee">  266</a></span>&nbsp;DIFSECT    = 0xFFFFFFFC; <span class="comment"># (-4) denotes a DIFAT sector in a FAT</span></div><div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a396991cd1d934c16398e6746b7a046c5">  267</a></span>&nbsp;FATSECT    = 0xFFFFFFFD; <span class="comment"># (-3) denotes a FAT sector in a FAT</span></div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a19d728cfe92679fdbf04d59c4fbd540a">  268</a></span>&nbsp;ENDOFCHAIN = 0xFFFFFFFE; <span class="comment"># (-2) end of a virtual stream chain</span></div><div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af00097c17b58aee1b4bda3d0fb8dfce0">  269</a></span>&nbsp;FREESECT   = 0xFFFFFFFF; <span class="comment"># (-1) unallocated sector</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&nbsp;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&nbsp;<span class="comment">#[PL]: added constants for Directory Entry IDs (from AAF specifications)</span></div><div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a6451574ab42d5675bdf5b13b34e605fc">  272</a></span>&nbsp;MAXREGSID  = 0xFFFFFFFA; <span class="comment"># maximum directory entry ID</span></div><div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a9bb71a4cee935d3925adc47d8c968b3d">  273</a></span>&nbsp;NOSTREAM   = 0xFFFFFFFF; <span class="comment"># (-1) unallocated directory entry</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&nbsp;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&nbsp;<span class="comment">#[PL] object types in storage (from AAF specifications)</span></div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a47f9aba9bcd20a4a812de624fb1519bb">  276</a></span>&nbsp;STGTY_EMPTY     = 0 <span class="comment"># empty directory entry (according to OpenOffice.org doc)</span></div><div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a780adbce049d5b735be4febbae316a8b">  277</a></span>&nbsp;STGTY_STORAGE   = 1 <span class="comment"># element is a storage object</span></div><div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a38de60d272599898cd5590eafbf32420">  278</a></span>&nbsp;STGTY_STREAM    = 2 <span class="comment"># element is a stream object</span></div><div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aacf31f28da781e18c1cff6420feba531">  279</a></span>&nbsp;STGTY_LOCKBYTES = 3 <span class="comment"># element is an ILockBytes object</span></div><div class="line"><a name="l00280"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a41eb0b95f2b65ab4858a61046ffaf47a">  280</a></span>&nbsp;STGTY_PROPERTY  = 4 <span class="comment"># element is an IPropertyStorage object</span></div><div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#afcb7bc85b9da75b9b7473524a75e3ea6">  281</a></span>&nbsp;STGTY_ROOT      = 5 <span class="comment"># element is a root storage</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&nbsp;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&nbsp;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&nbsp;<span class="comment"># --------------------------------------------------------------------</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&nbsp;<span class="comment"># property types</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&nbsp;</div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab0da8ef18a8abbde6f61c3fc2b0725c9">  288</a></span>&nbsp;VT_EMPTY=0; VT_NULL=1; VT_I2=2; VT_I4=3; VT_R4=4; VT_R8=5; VT_CY=6;</div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a9571af92dcc3de751db8badc4ad5f70a">  289</a></span>&nbsp;VT_DATE=7; VT_BSTR=8; VT_DISPATCH=9; VT_ERROR=10; VT_BOOL=11;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af18782cdd2fb2e68dfc6deb75fc68646">  290</a></span>&nbsp;VT_VARIANT=12; VT_UNKNOWN=13; VT_DECIMAL=14; VT_I1=16; VT_UI1=17;</div><div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a7cc86fd13cc065de0a033094204a2b1b">  291</a></span>&nbsp;VT_UI2=18; VT_UI4=19; VT_I8=20; VT_UI8=21; VT_INT=22; VT_UINT=23;</div><div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a7cc10da03820b8d9d0ead15dcd0f6c4b">  292</a></span>&nbsp;VT_VOID=24; VT_HRESULT=25; VT_PTR=26; VT_SAFEARRAY=27; VT_CARRAY=28;</div><div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a26306fe6c42115cd6f871a56b772e854">  293</a></span>&nbsp;VT_USERDEFINED=29; VT_LPSTR=30; VT_LPWSTR=31; VT_FILETIME=64;</div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a86a4e0ab2262ee6c911ca3d565be9073">  294</a></span>&nbsp;VT_BLOB=65; VT_STREAM=66; VT_STORAGE=67; VT_STREAMED_OBJECT=68;</div><div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a05a62f8e40c2d60f893c77640a8b36e0">  295</a></span>&nbsp;VT_STORED_OBJECT=69; VT_BLOB_OBJECT=70; VT_CF=71; VT_CLSID=72;</div><div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a77971b26c14ebd7fde7554f12f28356f">  296</a></span>&nbsp;VT_VECTOR=0x1000;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&nbsp;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&nbsp;<span class="comment">#</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&nbsp;<span class="comment"># --------------------------------------------------------------------</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&nbsp;<span class="comment"># Some common document types (root.clsid fields)</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&nbsp;</div><div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab05919fa2fb6a1322bf2a93282544cc3">  302</a></span>&nbsp;WORD_CLSID = <span class="stringliteral">"00020900-0000-0000-C000-000000000046"</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&nbsp;<span class="comment">#TODO: check Excel, PPT, ...</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&nbsp;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&nbsp;<span class="comment">#[PL]: Defect levels to classify parsing errors - see OleFileIO._raise_defect()</span></div><div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af98af344daa9e997fa0b98d1dc02b9a8">  306</a></span>&nbsp;DEFECT_UNSURE =    10    <span class="comment"># a case which looks weird, but not sure it's a defect</span></div><div class="line"><a name="l00307"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#adaba1f7239bee451c103b3550b911ff9">  307</a></span>&nbsp;DEFECT_POTENTIAL = 20    <span class="comment"># a potential defect</span></div><div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2f95eafd789158e14d5a559c6e6d6fb0">  308</a></span>&nbsp;DEFECT_INCORRECT = 30    <span class="comment"># an error according to specifications, but parsing</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&nbsp;                         <span class="comment"># can go on</span></div><div class="line"><a name="l00310"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a64abb9d3e374149267b4e3669aae61ff">  310</a></span>&nbsp;DEFECT_FATAL =     40    <span class="comment"># an error which cannot be ignored, parsing is</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&nbsp;                         <span class="comment"># impossible</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&nbsp;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&nbsp;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&nbsp;<span class="comment">#--- FUNCTIONS ----------------------------------------------------------------</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&nbsp;</div><div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a82e31e7881340f7f382bf4ad227077de">  316</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a82e31e7881340f7f382bf4ad227077de">isOleFile</a> (filename):</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&nbsp;<span class="stringliteral">    Test if file is an OLE container (according to its header).</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&nbsp;<span class="stringliteral">    filename: file name or path (str, unicode)</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&nbsp;<span class="stringliteral">    return: True if OLE, False otherwise.</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&nbsp;    f = open(filename, <span class="stringliteral">'rb'</span>)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&nbsp;    header = f.read(len(MAGIC))</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&nbsp;    <span class="keywordflow">if</span> header == MAGIC:</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&nbsp;        <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&nbsp;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&nbsp;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&nbsp;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&nbsp;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&nbsp;<span class="comment">#TODO: replace i16 and i32 with more readable struct.unpack equivalent</span></div><div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aeec9fd188c4676ba88a40d511f766d30">  331</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aeec9fd188c4676ba88a40d511f766d30">i16</a>(c, o = 0):</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&nbsp;<span class="stringliteral">    Converts a 2-bytes (16 bits) string to an integer.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&nbsp;<span class="stringliteral">    c: string containing bytes to convert</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&nbsp;<span class="stringliteral">    o: offset of bytes to convert in string</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&nbsp;    <span class="keywordflow">if</span> isinstance(c[o], int):</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&nbsp;        <span class="keywordflow">return</span> c[o] + (c[o+1]&lt;&lt;8)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&nbsp;    <span class="keywordflow">return</span> ord(c[o])+(ord(c[o+1])&lt;&lt;8)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&nbsp;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&nbsp;</div><div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a333e3b3dd02b5516713781bfbe50e3d6">  343</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a333e3b3dd02b5516713781bfbe50e3d6">i32</a>(c, o = 0):</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&nbsp;<span class="stringliteral">    Converts a 4-bytes (32 bits) string to an integer.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&nbsp;<span class="stringliteral">    c: string containing bytes to convert</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&nbsp;<span class="stringliteral">    o: offset of bytes to convert in string</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&nbsp;    <span class="keywordflow">if</span> isinstance(c[o], int):</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&nbsp;        <span class="keywordflow">return</span> c[o] + (c[o+1]&lt;&lt;8) + (c[o+2]&lt;&lt;16) + (c[o+3]&lt;&lt;24)</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&nbsp;    <span class="keywordflow">return</span> int(ord(c[o])+(ord(c[o+1])&lt;&lt;8)+(ord(c[o+2])&lt;&lt;16)+(ord(c[o+3])&lt;&lt;24))</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&nbsp;    <span class="comment"># [PL]: added int() because "&lt;&lt;" gives long int since Python 2.4</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&nbsp;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&nbsp;</div><div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a00459a74c4f6f514cd22ee6f9887e37f">  356</a></span>&nbsp;<span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a00459a74c4f6f514cd22ee6f9887e37f">_clsid</a>(clsid):</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&nbsp;<span class="stringliteral">    Converts a CLSID to a human-readable string.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&nbsp;<span class="stringliteral">    clsid: string of length 16.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&nbsp;    <span class="keyword">assert</span> len(clsid) == 16</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&nbsp;    <span class="keywordflow">if</span> clsid == <span class="stringliteral">"\0"</span> * len(clsid):</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&nbsp;        <span class="keywordflow">return</span> <span class="stringliteral">""</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&nbsp;    <span class="keywordflow">return</span> ((<span class="stringliteral">"%08X-%04X-%04X-%02X%02X-"</span> + <span class="stringliteral">"%02X"</span> * 6) %</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&nbsp;            ((<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a333e3b3dd02b5516713781bfbe50e3d6">i32</a>(clsid, 0), <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aeec9fd188c4676ba88a40d511f766d30">i16</a>(clsid, 4), <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aeec9fd188c4676ba88a40d511f766d30">i16</a>(clsid, 6)) +</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&nbsp;            tuple(<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/weird__another__fmt__plug_8c.html#ac95378190d8b79ac8ef51d60628a268a">map</a>(ord, clsid[8:16]))))</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&nbsp;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&nbsp;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&nbsp;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&nbsp;<span class="comment"># UNICODE support for Old Python versions:</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&nbsp;<span class="comment"># (necessary to handle storages/streams names which use Unicode)</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&nbsp;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&nbsp;<span class="keywordflow">try</span>:</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&nbsp;    <span class="comment"># is Unicode supported ?</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a29c4cf0d99d984c6d6d580fdb33e29ac">_unicode</a>(s, errors='replace'):</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&nbsp;<span class="stringliteral">        Map unicode string to Latin 1. (Python with Unicode support)</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&nbsp;<span class="stringliteral">        s: UTF-16LE unicode string to convert to Latin-1</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&nbsp;<span class="stringliteral">        errors: 'replace', 'ignore' or 'strict'. See Python doc for unicode()</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&nbsp;        <span class="comment">#TODO: test if it OleFileIO works with Unicode strings, instead of</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&nbsp;        <span class="comment">#      converting to Latin-1.</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&nbsp;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&nbsp;            <span class="comment"># First the string is converted to plain Unicode:</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&nbsp;            <span class="comment"># (assuming it is encoded as UTF-16 little-endian)</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&nbsp;            u = s.decode(<span class="stringliteral">'UTF-16LE'</span>, errors)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&nbsp;            <span class="keywordflow">if</span> KEEP_UNICODE_NAMES:</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&nbsp;                <span class="keywordflow">return</span> u</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&nbsp;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&nbsp;                <span class="comment"># Second the unicode string is converted to Latin-1</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&nbsp;                <span class="keywordflow">return</span> u.encode(<span class="stringliteral">'latin_1'</span>, errors)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&nbsp;        <span class="keywordflow">except</span>:</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&nbsp;            <span class="comment"># there was an error during Unicode to Latin-1 conversion:</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&nbsp;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect Unicode name'</span>)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&nbsp;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&nbsp;<span class="keywordflow">except</span> NameError:</div><div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a29c4cf0d99d984c6d6d580fdb33e29ac">  398</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a29c4cf0d99d984c6d6d580fdb33e29ac">_unicode</a>(s, errors='replace'):</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&nbsp;<span class="stringliteral">        Map unicode string to Latin 1. (Python without native Unicode support)</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&nbsp;<span class="stringliteral">        s: UTF-16LE unicode string to convert to Latin-1</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&nbsp;<span class="stringliteral">        errors: 'replace', 'ignore' or 'strict'. (ignored in this version)</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&nbsp;        <span class="comment"># If the unicode function does not exist, we assume this is an old</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&nbsp;        <span class="comment"># Python version without Unicode support.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&nbsp;        <span class="comment"># Null bytes are simply removed (this only works with usual Latin-1</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&nbsp;        <span class="comment"># strings which do not contain unicode characters&gt;256):</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&nbsp;        <span class="keywordflow">return</span> filter(ord, s) <span class="comment"># this is bullshit!</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&nbsp;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&nbsp;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&nbsp;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&nbsp;<span class="comment">#=== CLASSES ==================================================================</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&nbsp;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&nbsp;<span class="comment">#--- _OleStream ---------------------------------------------------------------</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&nbsp;</div><div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html">  417</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html">_OleStream</a>(<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceml2john.html#a8e9e260274be9b9735a547485266df24">StringIO</a>):</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&nbsp;<span class="stringliteral">    OLE2 Stream</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&nbsp;<span class="stringliteral">    Returns a read-only file object which can be used to read</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&nbsp;<span class="stringliteral">    the contents of an OLE stream (instance of the StringIO class).</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&nbsp;<span class="stringliteral">    To open a stream, use the openstream method in the OleFile class.</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&nbsp;<span class="stringliteral">    This function can be used with either ordinary streams,</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&nbsp;<span class="stringliteral">    or ministreams, depending on the offset, sectorsize, and</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&nbsp;<span class="stringliteral">    fat table arguments.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&nbsp;<span class="stringliteral">    Attributes:</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&nbsp;<span class="stringliteral">        - size: actual size of data stream, after it was opened.</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&nbsp;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&nbsp;    <span class="comment"># FIXME: should store the list of sects obtained by following</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&nbsp;    <span class="comment"># the fat chain, and load new sectors on demand instead of</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&nbsp;    <span class="comment"># loading it all in one go.</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&nbsp;</div><div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html#a0ec1cd49dd03f32b008d1b328dbcab49">  437</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html#a0ec1cd49dd03f32b008d1b328dbcab49">__init__</a>(self, fp, sect, size, offset, sectorsize, fat, filesize):</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&nbsp;<span class="stringliteral">        Constructor for _OleStream class.</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&nbsp;<span class="stringliteral">        fp        : file object, the OLE container or the MiniFAT stream</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&nbsp;<span class="stringliteral">        sect      : sector index of first sector in the stream</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&nbsp;<span class="stringliteral">        size      : total size of the stream</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&nbsp;<span class="stringliteral">        offset    : offset in bytes for the first FAT or MiniFAT sector</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&nbsp;<span class="stringliteral">        sectorsize: size of one sector</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&nbsp;<span class="stringliteral">        fat       : array/list of sector indexes (FAT or MiniFAT)</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&nbsp;<span class="stringliteral">        filesize  : size of OLE file (for debugging)</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&nbsp;<span class="stringliteral">        return    : a StringIO instance containing the OLE stream</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'_OleStream.__init__:'</span>)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'  sect=%d (%X), size=%d, offset=%d, sectorsize=%d, len(fat)=%d, fp=%s'</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&nbsp;            %(sect,sect,size,offset,sectorsize,len(fat), repr(fp)))</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&nbsp;        <span class="comment">#[PL] To detect malformed documents with FAT loops, we compute the</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&nbsp;        <span class="comment"># expected number of sectors in the stream:</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&nbsp;        unknown_size = <span class="keyword">False</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&nbsp;        <span class="keywordflow">if</span> size==0x7FFFFFFF:</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&nbsp;            <span class="comment"># this is the case when called from OleFileIO._open(), and stream</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&nbsp;            <span class="comment"># size is not known in advance (for example when reading the</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&nbsp;            <span class="comment"># Directory stream). Then we can only guess maximum size:</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&nbsp;            size = len(fat)*sectorsize</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&nbsp;            <span class="comment"># and we keep a record that size was unknown:</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&nbsp;            unknown_size = <span class="keyword">True</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'  stream with UNKNOWN SIZE'</span>)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&nbsp;        nb_sectors = (size + (sectorsize-1)) / sectorsize</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&nbsp;        nb_sectors = int(nb_sectors)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&nbsp;        <span class="comment"># print('nb_sectors = %d' % nb_sectors)</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&nbsp;        <span class="comment"># This number should (at least) be less than the total number of</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&nbsp;        <span class="comment"># sectors in the given FAT:</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&nbsp;        <span class="keywordflow">if</span> nb_sectors &gt; len(fat):</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&nbsp;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&nbsp;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'malformed OLE document, stream too large'</span>)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&nbsp;        <span class="comment"># optimization(?): data is first a list of strings, and join() is called</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&nbsp;        <span class="comment"># at the end to concatenate all in one string.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&nbsp;        <span class="comment"># (this may not be really useful with recent Python versions)</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&nbsp;        data = []</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&nbsp;        <span class="comment"># if size is zero, then first sector index should be ENDOFCHAIN:</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&nbsp;        <span class="keywordflow">if</span> size == 0 <span class="keywordflow">and</span> sect != ENDOFCHAIN:</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'size == 0 and sect != ENDOFCHAIN:'</span>)</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&nbsp;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect OLE sector index for empty stream'</span>)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&nbsp;        <span class="comment">#[PL] A fixed-length for loop is used instead of an undefined while</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&nbsp;        <span class="comment"># loop to avoid DoS attacks:</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&nbsp;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(nb_sectors):</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&nbsp;            <span class="comment"># Sector index may be ENDOFCHAIN, but only if size was unknown</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&nbsp;            <span class="keywordflow">if</span> sect == ENDOFCHAIN:</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&nbsp;                <span class="keywordflow">if</span> unknown_size:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&nbsp;                    <span class="keywordflow">break</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&nbsp;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&nbsp;                    <span class="comment"># else this means that the stream is smaller than declared:</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&nbsp;                    <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'sect=ENDOFCHAIN before expected size'</span>)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&nbsp;                    <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incomplete OLE stream'</span>)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&nbsp;            <span class="comment"># sector index should be within FAT:</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&nbsp;            <span class="keywordflow">if</span> sect&lt;0 <span class="keywordflow">or</span> sect&gt;=len(fat):</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'sect=%d (%X) / len(fat)=%d'</span> % (sect, sect, len(fat)))</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'i=%d / nb_sectors=%d'</span> %(i, nb_sectors))</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&nbsp;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect OLE FAT, sector index out of range'</span>)</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&nbsp;            <span class="comment">#TODO: merge this code with OleFileIO.getsect() ?</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&nbsp;            <span class="comment">#TODO: check if this works with 4K sectors:</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&nbsp;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&nbsp;                fp.seek(offset + sectorsize * sect)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&nbsp;            <span class="keywordflow">except</span>:</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'sect=%d, seek=%d, filesize=%d'</span> %</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&nbsp;                    (sect, offset+sectorsize*sect, filesize))</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'OLE sector index out of range'</span>)</div><div class="line"><a name="l00509"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac0f5503d61d89272f62b3e408edb7f38">  509</a></span>&nbsp;            sector_data = fp.read(sectorsize)</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&nbsp;            <span class="comment"># [PL] check if there was enough data:</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&nbsp;            <span class="comment"># Note: if sector is the last of the file, sometimes it is not a</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&nbsp;            <span class="comment"># complete sector (of 512 or 4K), so we may read less than</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&nbsp;            <span class="comment"># sectorsize.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&nbsp;            <span class="keywordflow">if</span> len(sector_data)!=sectorsize <span class="keywordflow">and</span> sect!=(len(fat)-1):</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'sect=%d / len(fat)=%d, seek=%d / filesize=%d, len read=%d'</span> %</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&nbsp;                    (sect, len(fat), offset+sectorsize*sect, filesize, len(sector_data)))</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'seek+len(read)=%d'</span> % (offset+sectorsize*sect+len(sector_data)))</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incomplete OLE sector'</span>)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&nbsp;            data.append(sector_data)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&nbsp;            <span class="comment"># jump to next sector in the FAT:</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&nbsp;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00522"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af43595bb6430b5be92d8c23e7e564d28">  522</a></span>&nbsp;                sect = fat[sect]</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&nbsp;            <span class="keywordflow">except</span> IndexError:</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&nbsp;                <span class="comment"># [PL] if pointer is out of the FAT an exception is raised</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect OLE FAT, sector index out of range'</span>)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&nbsp;        <span class="comment">#[PL] Last sector should be a "end of chain" marker:</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&nbsp;        <span class="keywordflow">if</span> sect != ENDOFCHAIN:</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&nbsp;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect last sector index in OLE stream'</span>)</div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aa0efabcf2199932496dcb5d74c62101d">  529</a></span>&nbsp;        data = b<span class="stringliteral">""</span>.join(data)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&nbsp;        <span class="comment"># data = string.join(data, "")</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&nbsp;        <span class="comment"># Data is truncated to the actual stream size:</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&nbsp;        <span class="keywordflow">if</span> len(data) &gt;= size:</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&nbsp;            data = data[:size]</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&nbsp;            <span class="comment"># actual stream size is stored for future use:</span></div><div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a0a7700a91107a5a4543a254d675ae683">  535</a></span>&nbsp;            self.size = size</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&nbsp;        <span class="keywordflow">elif</span> unknown_size:</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&nbsp;            <span class="comment"># actual stream size was not known, now we know the size of read</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&nbsp;            <span class="comment"># data:</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&nbsp;            self.size = len(data)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&nbsp;            <span class="comment"># read data is less than expected:</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'len(data)=%d, size=%d'</span> % (len(data), size))</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&nbsp;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'OLE stream size is less than declared'</span>)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&nbsp;        <span class="comment"># when all data is read in memory, StringIO constructor is called</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&nbsp;        StringIO.__init__(self, data)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&nbsp;        <span class="comment"># Then the _OleStream object can be used as a read-only file object.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&nbsp;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&nbsp;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&nbsp;<span class="comment">#--- _OleDirectoryEntry -------------------------------------------------------</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&nbsp;</div><div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html">  551</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html">_OleDirectoryEntry</a>:</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&nbsp;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&nbsp;<span class="stringliteral">    OLE2 Directory Entry</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&nbsp;    <span class="comment">#[PL] parsing code moved from OleFileIO.loaddirectory</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&nbsp;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&nbsp;    <span class="comment"># struct to parse directory entries:</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&nbsp;    <span class="comment"># &lt;: little-endian byte order</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&nbsp;    <span class="comment"># 64s: string containing entry name in unicode (max 31 chars) + null char</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&nbsp;    <span class="comment"># H: uint16, number of bytes used in name buffer, including null = (len+1)*2</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&nbsp;    <span class="comment"># B: uint8, dir entry type (between 0 and 5)</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&nbsp;    <span class="comment"># B: uint8, color: 0=black, 1=red</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&nbsp;    <span class="comment"># I: uint32, index of left child node in the red-black tree, NOSTREAM if none</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&nbsp;    <span class="comment"># I: uint32, index of right child node in the red-black tree, NOSTREAM if none</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&nbsp;    <span class="comment"># I: uint32, index of child root node if it is a storage, else NOSTREAM</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&nbsp;    <span class="comment"># 16s: CLSID, unique identifier (only used if it is a storage)</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&nbsp;    <span class="comment"># I: uint32, user flags</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&nbsp;    <span class="comment"># 8s: uint64, creation timestamp or zero</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&nbsp;    <span class="comment"># 8s: uint64, modification timestamp or zero</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&nbsp;    <span class="comment"># I: uint32, SID of first sector if stream or ministream, SID of 1st sector</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&nbsp;    <span class="comment">#    of stream containing ministreams if root entry, 0 otherwise</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&nbsp;    <span class="comment"># I: uint32, total stream size in bytes if stream (low 32 bits), 0 otherwise</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&nbsp;    <span class="comment"># I: uint32, total stream size in bytes if stream (high 32 bits), 0 otherwise</span></div><div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a612a2a6f11921249a93bab35b749debd">  575</a></span>&nbsp;    STRUCT_DIRENTRY = <span class="stringliteral">'&lt;64sHBBIII16sI8s8sIII'</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&nbsp;    <span class="comment"># size of a directory entry: 128 bytes</span></div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a6f1a4ee2f6cb7d15e33b516ae544b059">  577</a></span>&nbsp;    DIRENTRY_SIZE = 128</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&nbsp;    <span class="keyword">assert</span> struct.calcsize(STRUCT_DIRENTRY) == DIRENTRY_SIZE</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&nbsp;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&nbsp;</div><div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a1045ff760bdd40a5248ed1d64caa48ed">  581</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a1045ff760bdd40a5248ed1d64caa48ed">__init__</a>(self, entry, sid, olefile):</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&nbsp;<span class="stringliteral">        Constructor for an _OleDirectoryEntry object.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&nbsp;<span class="stringliteral">        Parses a 128-bytes entry from the OLE Directory stream.</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&nbsp;<span class="stringliteral">        entry  : string (must be 128 bytes long)</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&nbsp;<span class="stringliteral">        sid    : index of this directory entry in the OLE file directory</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&nbsp;<span class="stringliteral">        olefile: OleFileIO containing this directory entry</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ade2546a20232bf24d38aff58204c3303">  590</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ade2546a20232bf24d38aff58204c3303">sid</a> = sid</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&nbsp;        <span class="comment"># ref to olefile is stored for future use</span></div><div class="line"><a name="l00592"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">  592</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">olefile</a> = olefile</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&nbsp;        <span class="comment"># kids is a list of children entries, if this entry is a storage:</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&nbsp;        <span class="comment"># (list of _OleDirectoryEntry objects)</span></div><div class="line"><a name="l00595"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a10f76c07f25d3f78e4897def69b4f340">  595</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a10f76c07f25d3f78e4897def69b4f340">kids</a> = []</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&nbsp;        <span class="comment"># kids_dict is a dictionary of children entries, indexed by their</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&nbsp;        <span class="comment"># name in lowercase: used to quickly find an entry, and to detect</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&nbsp;        <span class="comment"># duplicates</span></div><div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a05cd0f79d88db350368ea3a3cd84253e">  599</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a05cd0f79d88db350368ea3a3cd84253e">kids_dict</a> = {}</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&nbsp;        <span class="comment"># flag used to detect if the entry is referenced more than once in</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&nbsp;        <span class="comment"># directory:</span></div><div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#aa881d22e1178a8ba147968205d8f782c">  602</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#aa881d22e1178a8ba147968205d8f782c">used</a> = <span class="keyword">False</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&nbsp;        <span class="comment"># decode DirEntry</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&nbsp;        (</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&nbsp;            name,</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&nbsp;            namelength,</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a>,</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&nbsp;            self.color,</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&nbsp;            self.sid_left,</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&nbsp;            self.sid_right,</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&nbsp;            self.sid_child,</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&nbsp;            clsid,</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&nbsp;            self.dwUserFlags,</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&nbsp;            self.createTime,</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&nbsp;            self.modifyTime,</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&nbsp;            self.isectStart,</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&nbsp;            sizeLow,</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&nbsp;            sizeHigh</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&nbsp;        ) = struct.unpack(_OleDirectoryEntry.STRUCT_DIRENTRY, entry)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [STGTY_ROOT, STGTY_STORAGE, STGTY_STREAM, STGTY_EMPTY]:</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&nbsp;            olefile._raise_defect(DEFECT_INCORRECT, <span class="stringliteral">'unhandled OLE storage type'</span>)</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&nbsp;        <span class="comment"># only first directory entry can (and should) be root:</span></div><div class="line"><a name="l00623"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">  623</a></span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a> == STGTY_ROOT <span class="keywordflow">and</span> sid != 0:</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&nbsp;            olefile._raise_defect(DEFECT_INCORRECT, <span class="stringliteral">'duplicate OLE root entry'</span>)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&nbsp;        <span class="keywordflow">if</span> sid == 0 <span class="keywordflow">and</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a> != STGTY_ROOT:</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&nbsp;            olefile._raise_defect(DEFECT_INCORRECT, <span class="stringliteral">'incorrect OLE root entry'</span>)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&nbsp;        <span class="comment">#debug (struct.unpack(fmt_entry, entry[:len_entry]))</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&nbsp;        <span class="comment"># name should be at most 31 unicode characters + null character,</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&nbsp;        <span class="comment"># so 64 bytes in total (31*2 + 2):</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&nbsp;        <span class="keywordflow">if</span> namelength&gt;64:</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&nbsp;            olefile._raise_defect(DEFECT_INCORRECT, <span class="stringliteral">'incorrect DirEntry name length'</span>)</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&nbsp;            <span class="comment"># if exception not raised, namelength is set to the maximum value:</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&nbsp;            namelength = 64</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&nbsp;        <span class="comment"># only characters without ending null char are kept:</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&nbsp;        name = name[:(namelength-2)]</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&nbsp;        <span class="comment"># name is converted from unicode to Latin-1:</span></div><div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ac047fb25c0e99442f3d44fead84ae262">  637</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ac047fb25c0e99442f3d44fead84ae262">name</a> = <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a29c4cf0d99d984c6d6d580fdb33e29ac">_unicode</a>(name)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&nbsp;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&nbsp;        debug (<span class="stringliteral">"OLE name: %s"</span> % name)</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'DirEntry SID=%d: %s'</span> % (self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ade2546a20232bf24d38aff58204c3303">sid</a>, repr(self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ac047fb25c0e99442f3d44fead84ae262">name</a>)))</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">' - type: %d'</span> % self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a>)</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">' - sect: %d'</span> % self.isectStart)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">' - SID left: %d, right: %d, child: %d'</span> % (self.sid_left,</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&nbsp;            self.sid_right, self.sid_child))</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&nbsp;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&nbsp;        <span class="comment"># sizeHigh is only used for 4K sectors, it should be zero for 512 bytes</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&nbsp;        <span class="comment"># sectors, BUT apparently some implementations set it as 0xFFFFFFFFL, 1</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&nbsp;        <span class="comment"># or some other value so it cannot be raised as a defect in general:</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&nbsp;        <span class="keywordflow">if</span> olefile.sectorsize == 512:</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&nbsp;            <span class="keywordflow">if</span> sizeHigh != 0 <span class="keywordflow">and</span> sizeHigh != 0xFFFFFFFF:</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'sectorsize=%d, sizeLow=%d, sizeHigh=%d (%X)'</span> %</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&nbsp;                    (olefile.sectorsize, sizeLow, sizeHigh, sizeHigh))</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&nbsp;                olefile._raise_defect(DEFECT_UNSURE, <span class="stringliteral">'incorrect OLE stream size'</span>)</div><div class="line"><a name="l00654"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">  654</a></span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">size</a> = sizeLow</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">size</a> = sizeLow + (long(sizeHigh)&lt;&lt;32)</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">' - size: %d (sizeLow=%d, sizeHigh=%d)'</span> % (self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">size</a>, sizeLow, sizeHigh))</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&nbsp;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&nbsp;        <span class="comment"># self.clsid = _clsid(clsid)</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&nbsp;        <span class="comment"># a storage should have a null size, BUT some implementations such as</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&nbsp;        <span class="comment"># Word 8 for Mac seem to allow non-null values =&gt; Potential defect:</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a> == STGTY_STORAGE <span class="keywordflow">and</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">size</a> != 0:</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&nbsp;            olefile._raise_defect(DEFECT_POTENTIAL, <span class="stringliteral">'OLE storage with size&gt;0'</span>)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&nbsp;        <span class="comment"># check if stream is not already referenced elsewhere:</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a> <span class="keywordflow">in</span> (STGTY_ROOT, STGTY_STREAM) <span class="keywordflow">and</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">size</a>&gt;0:</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&nbsp;            <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">size</a> &lt; olefile.minisectorcutoff \</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&nbsp;            <span class="keywordflow">and</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">entry_type</a>==STGTY_STREAM: <span class="comment"># only streams can be in MiniFAT</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&nbsp;                <span class="comment"># ministream object</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&nbsp;                minifat = <span class="keyword">True</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&nbsp;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&nbsp;                minifat = <span class="keyword">False</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&nbsp;            olefile._check_duplicate_stream(self.isectStart, minifat)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&nbsp;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&nbsp;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&nbsp;</div><div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a507ce75696f13b9510cd886cbef7ff69">  676</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a507ce75696f13b9510cd886cbef7ff69">build_storage_tree</a>(self):</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&nbsp;<span class="stringliteral">        Read and build the red-black tree attached to this _OleDirectoryEntry</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&nbsp;<span class="stringliteral">        object, if it is a storage.</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&nbsp;<span class="stringliteral">        Note that this method builds a tree of all subentries, so it should</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&nbsp;<span class="stringliteral">        only be called for the root object once.</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'build_storage_tree: SID=%d - %s - sid_child=%d'</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&nbsp;            % (self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ade2546a20232bf24d38aff58204c3303">sid</a>, repr(self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ac047fb25c0e99442f3d44fead84ae262">name</a>), self.sid_child))</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&nbsp;        <span class="keywordflow">if</span> self.sid_child != NOSTREAM:</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&nbsp;            <span class="comment"># if child SID is not NOSTREAM, then this entry is a storage.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&nbsp;            <span class="comment"># Let's walk through the tree of children to fill the kids list:</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3167fe801afa969e82b6dd0e16bd026f">append_kids</a>(self.sid_child)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&nbsp;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&nbsp;            <span class="comment"># Note from OpenOffice documentation: the safest way is to</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&nbsp;            <span class="comment"># recreate the tree because some implementations may store broken</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&nbsp;            <span class="comment"># red-black trees...</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&nbsp;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&nbsp;            <span class="comment"># in the OLE file, entries are sorted on (length, name).</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&nbsp;            <span class="comment"># for convenience, we sort them on name instead:</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&nbsp;            <span class="comment"># (see __cmp__ method in this class)</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&nbsp;            <span class="comment"># self.kids.sort()</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&nbsp;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&nbsp;</div><div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3167fe801afa969e82b6dd0e16bd026f">  700</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3167fe801afa969e82b6dd0e16bd026f">append_kids</a>(self, child_sid):</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&nbsp;<span class="stringliteral">        Walk through red-black tree of children of this directory entry to add</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&nbsp;<span class="stringliteral">        all of them to the kids list. (recursive method)</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&nbsp;<span class="stringliteral">        child_sid : index of child directory entry to use, or None when called</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&nbsp;<span class="stringliteral">                    first time for the root. (only used during recursion)</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&nbsp;        <span class="comment">#[PL] this method was added to use simple recursion instead of a complex</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&nbsp;        <span class="comment"># algorithm.</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&nbsp;        <span class="comment"># if this is not a storage or a leaf of the tree, nothing to do:</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&nbsp;        <span class="keywordflow">if</span> child_sid == NOSTREAM:</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&nbsp;            <span class="keywordflow">return</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&nbsp;        <span class="comment"># check if child SID is in the proper range:</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&nbsp;        <span class="keywordflow">if</span> child_sid&lt;0 <span class="keywordflow">or</span> child_sid&gt;=len(self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">olefile</a>.direntries):</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">olefile</a>._raise_defect(DEFECT_FATAL, <span class="stringliteral">'OLE DirEntry index out of range'</span>)</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&nbsp;        <span class="comment"># get child direntry:</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&nbsp;        child = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">olefile</a>.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a45a0bd5a6df12d5abc3ad3c866411705">_load_direntry</a>(child_sid) <span class="comment">#direntries[child_sid]</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'append_kids: child_sid=%d - %s - sid_left=%d, sid_right=%d, sid_child=%d'</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&nbsp;            % (child.sid, repr(child.name), child.sid_left, child.sid_right, child.sid_child))</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&nbsp;        <span class="comment"># the directory entries are organized as a red-black tree.</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&nbsp;        <span class="comment"># (cf. Wikipedia for details)</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&nbsp;        <span class="comment"># First walk through left side of the tree:</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3167fe801afa969e82b6dd0e16bd026f">append_kids</a>(child.sid_left)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&nbsp;        <span class="comment"># Check if its name is not already used (case-insensitive):</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&nbsp;        <span class="comment"># name_lower = child.name</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&nbsp;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> PY3:</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&nbsp;            child.name = child.name.decode()</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&nbsp;        name_lower = child.name.lower()</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a05cd0f79d88db350368ea3a3cd84253e">kids_dict</a>.get(name_lower, <span class="keywordtype">None</span>):</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">olefile</a>._raise_defect(DEFECT_INCORRECT,</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&nbsp;                <span class="stringliteral">"Duplicate filename in OLE storage"</span>)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&nbsp;        <span class="comment"># Then the child_sid _OleDirectoryEntry object is appended to the</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&nbsp;        <span class="comment"># kids list and dictionary:</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a10f76c07f25d3f78e4897def69b4f340">kids</a>.append(child)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a05cd0f79d88db350368ea3a3cd84253e">kids_dict</a>[name_lower] = child</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&nbsp;        <span class="comment"># Check if kid was not already referenced in a storage:</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&nbsp;        <span class="keywordflow">if</span> child.used:</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">olefile</a>._raise_defect(DEFECT_INCORRECT,</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&nbsp;                <span class="stringliteral">'OLE Entry referenced more than once'</span>)</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&nbsp;        child.used = <span class="keyword">True</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&nbsp;        <span class="comment"># Finally walk through right side of the tree:</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3167fe801afa969e82b6dd0e16bd026f">append_kids</a>(child.sid_right)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&nbsp;        <span class="comment"># Afterwards build kid's own tree if it's also a storage:</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&nbsp;        child.build_storage_tree()</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&nbsp;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&nbsp;</div><div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a0d29d4f550cd5ca3627fbb90d730c2e6">  747</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a0d29d4f550cd5ca3627fbb90d730c2e6">__cmp__</a>(self, other):</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&nbsp;        <span class="stringliteral">"Compare entries by name"</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&nbsp;        <span class="keywordflow">return</span> cmp(self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ac047fb25c0e99442f3d44fead84ae262">name</a>, other.name)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&nbsp;        <span class="comment">#TODO: replace by the same function as MS implementation ?</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&nbsp;        <span class="comment"># (order by name length first, then case-insensitive order)</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&nbsp;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&nbsp;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&nbsp;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&nbsp;<span class="comment">#--- OleFileIO ----------------------------------------------------------------</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&nbsp;</div><div class="line"><a name="l00757"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html">  757</a></span>&nbsp;<span class="keyword">class </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html">OleFileIO</a>:</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&nbsp;<span class="stringliteral">    OLE container object</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&nbsp;<span class="stringliteral">    This class encapsulates the interface to an OLE 2 structured</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&nbsp;<span class="stringliteral">    storage file.  Use the {@link listdir} and {@link openstream} methods to</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&nbsp;<span class="stringliteral">    access the contents of this file.</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&nbsp;<span class="stringliteral">    Object names are given as a list of strings, one for each subentry</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&nbsp;<span class="stringliteral">    level.  The root entry should be omitted.  For example, the following</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&nbsp;<span class="stringliteral">    code extracts all image streams from a Microsoft Image Composer file:</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&nbsp;<span class="stringliteral">        ole = OleFileIO("fan.mic")</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&nbsp;<span class="stringliteral">        for entry in ole.listdir():</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&nbsp;<span class="stringliteral">            if entry[1:2] == "Image":</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&nbsp;<span class="stringliteral">                fin = ole.openstream(entry)</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&nbsp;<span class="stringliteral">                fout = open(entry[0:1], "wb")</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&nbsp;<span class="stringliteral">                while 1:</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&nbsp;<span class="stringliteral">                    s = fin.read(8192)</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&nbsp;<span class="stringliteral">                    if not s:</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&nbsp;<span class="stringliteral">                        break</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&nbsp;<span class="stringliteral">                    fout.write(s)</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&nbsp;<span class="stringliteral">    You can use the viewer application provided with the Python Imaging</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&nbsp;<span class="stringliteral">    Library to view the resulting files (which happens to be standard</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&nbsp;<span class="stringliteral">    TIFF files).</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&nbsp;</div><div class="line"><a name="l00786"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ab2030c99da115320b58a319d1a47be7c">  786</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ab2030c99da115320b58a319d1a47be7c">__init__</a>(self, filename = None, raise_defects=DEFECT_FATAL):</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&nbsp;<span class="stringliteral">        Constructor for OleFileIO class.</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&nbsp;<span class="stringliteral">        filename: file to open.</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&nbsp;<span class="stringliteral">        raise_defects: minimal level for defects to be raised as exceptions.</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&nbsp;<span class="stringliteral">        (use DEFECT_FATAL for a typical application, DEFECT_INCORRECT for a</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&nbsp;<span class="stringliteral">        security-oriented application, see source code for details)</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00795"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#abf70dfa4ce35d150a185f4ba8e5c1a38">  795</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#abf70dfa4ce35d150a185f4ba8e5c1a38">_raise_defects_level</a> = raise_defects</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&nbsp;        <span class="keywordflow">if</span> filename:</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af8cba11a47c45d643f2e4da58bfee60a">open</a>(filename)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&nbsp;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&nbsp;</div><div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">  800</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(self, defect_level, message):</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&nbsp;<span class="stringliteral">        This method should be called for any defect found during file parsing.</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&nbsp;<span class="stringliteral">        It may raise an IOError exception according to the minimal level chosen</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&nbsp;<span class="stringliteral">        for the OleFileIO object.</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&nbsp;<span class="stringliteral">        defect_level: defect level, possible values are:</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&nbsp;<span class="stringliteral">            DEFECT_UNSURE    : a case which looks weird, but not sure it's a defect</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&nbsp;<span class="stringliteral">            DEFECT_POTENTIAL : a potential defect</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&nbsp;<span class="stringliteral">            DEFECT_INCORRECT : an error according to specifications, but parsing can go on</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&nbsp;<span class="stringliteral">            DEFECT_FATAL     : an error which cannot be ignored, parsing is impossible</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&nbsp;<span class="stringliteral">        message: string describing the defect, used with raised exception.</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&nbsp;        <span class="comment"># added by [PL]</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&nbsp;        <span class="keywordflow">if</span> defect_level &gt;= self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#abf70dfa4ce35d150a185f4ba8e5c1a38">_raise_defects_level</a>:</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&nbsp;            <span class="keywordflow">raise</span> IOError(message)</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&nbsp;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&nbsp;</div><div class="line"><a name="l00818"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af8cba11a47c45d643f2e4da58bfee60a">  818</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af8cba11a47c45d643f2e4da58bfee60a">open</a>(self, filename):</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&nbsp;<span class="stringliteral">        Open an OLE2 file.</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&nbsp;<span class="stringliteral">        Reads the header, FAT and directory.</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&nbsp;<span class="stringliteral">        filename: string-like or file-like object</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&nbsp;        <span class="comment">#[PL] check if filename is a string-like or file-like object:</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&nbsp;        <span class="comment"># (it is better to check for a read() method)</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&nbsp;        <span class="keywordflow">if</span> hasattr(filename, <span class="stringliteral">'read'</span>):</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&nbsp;            <span class="comment"># file-like object</span></div><div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">  829</a></span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a> = filename</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&nbsp;            <span class="comment"># string-like object: filename of file on disk</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&nbsp;            <span class="comment">#TODO: if larger than 1024 bytes, this could be the actual data =&gt; StringIO</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a> = <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af8cba11a47c45d643f2e4da58bfee60a">open</a>(filename, <span class="stringliteral">"rb"</span>)</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&nbsp;        <span class="comment"># old code fails if filename is not a plain string:</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&nbsp;        <span class="comment">#if type(filename) == type(""):</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&nbsp;        <span class="comment">#    self.fp = open(filename, "rb")</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&nbsp;        <span class="comment">#else:</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&nbsp;        <span class="comment">#    self.fp = filename</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&nbsp;        <span class="comment"># obtain the filesize by using seek and tell, which should work on most</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&nbsp;        <span class="comment"># file-like objects:</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&nbsp;        <span class="comment">#TODO: do it above, using getsize with filename when possible?</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&nbsp;        <span class="comment">#TODO: fix code to fail with clear exception when filesize cannot be obtained</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a>.seek(0, os.SEEK_END)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&nbsp;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&nbsp;            filesize = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a>.tell()</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&nbsp;        <span class="keywordflow">finally</span>:</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a>.seek(0)</div><div class="line"><a name="l00848"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ac0e91fa98f715574b1ad3e31c7e54f79">  848</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ac0e91fa98f715574b1ad3e31c7e54f79">_filesize</a> = filesize</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&nbsp;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&nbsp;        <span class="comment"># lists of streams in FAT and MiniFAT, to detect duplicate references</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&nbsp;        <span class="comment"># (list of indexes of first sectors of each stream)</span></div><div class="line"><a name="l00852"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a4cbbcb333e7d637d2ac89ec48162d968">  852</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a4cbbcb333e7d637d2ac89ec48162d968">_used_streams_fat</a> = []</div><div class="line"><a name="l00853"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ad568d426eedc14ba3b447341c8b9bbaa">  853</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ad568d426eedc14ba3b447341c8b9bbaa">_used_streams_minifat</a> = []</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&nbsp;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&nbsp;        header = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a>.read(512)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&nbsp;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&nbsp;        <span class="keywordflow">if</span> len(header) != 512 <span class="keywordflow">or</span> header[:8] != MAGIC:</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_FATAL, <span class="stringliteral">"not an OLE2 structured storage file"</span>)</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&nbsp;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&nbsp;        <span class="comment"># [PL] header structure according to AAF specifications:</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&nbsp;        </div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&nbsp;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&nbsp;        <span class="comment"># [PL] header decoding:</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&nbsp;        <span class="comment"># '&lt;' indicates little-endian byte ordering for Intel (cf. struct module help)</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&nbsp;        fmt_header = <span class="stringliteral">'&lt;8s16sHHHHHHLLLLLLLLLL'</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&nbsp;        header_size = struct.calcsize(fmt_header)</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"fmt_header size = %d, +FAT = %d"</span> % (header_size, header_size + 109*4) )</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&nbsp;        header1 = header[:header_size]</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&nbsp;        (</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&nbsp;            self.Sig,</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&nbsp;            self.clsid,</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&nbsp;            self.MinorVersion,</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">DllVersion</a>,</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&nbsp;            self.ByteOrder,</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&nbsp;            self.SectorShift,</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&nbsp;            self.MiniSectorShift,</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&nbsp;            self.Reserved, self.Reserved1,</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&nbsp;            self.csectDir,</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&nbsp;            self.csectFat,</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&nbsp;            self.sectDirStart,</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&nbsp;            self.signature,</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&nbsp;            self.MiniSectorCutoff,</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&nbsp;            self.MiniFatStart,</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&nbsp;            self.csectMiniFat,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&nbsp;            self.sectDifStart,</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&nbsp;            self.csectDif</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&nbsp;        ) = struct.unpack(fmt_header, header1)</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( struct.unpack(fmt_header,    header1))</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&nbsp;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&nbsp;        <span class="keywordflow">if</span> self.Sig != b<span class="stringliteral">'\xd0\xcf\x11\xe0\xa1\xb1\x1a\xe1'</span>:</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&nbsp;            <span class="comment"># OLE signature should always be present</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_FATAL, <span class="stringliteral">"incorrect OLE signature"</span>)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&nbsp;        <span class="keywordflow">if</span> self.clsid != b<span class="stringliteral">'\x00'</span>*16:</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&nbsp;            <span class="comment"># according to AAF specs, CLSID should always be zero</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"incorrect CLSID in OLE header"</span>)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"MinorVersion = %d"</span> % self.MinorVersion )</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"DllVersion   = %d"</span> % self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">DllVersion</a> )</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">DllVersion</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [3, 4]:</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&nbsp;            <span class="comment"># version 3: usual format, 512 bytes per sector</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&nbsp;            <span class="comment"># version 4: large format, 4K per sector</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"incorrect DllVersion in OLE header"</span>)</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"ByteOrder    = %X"</span> % self.ByteOrder )</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&nbsp;        <span class="keywordflow">if</span> self.ByteOrder != 0xFFFE:</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&nbsp;            <span class="comment"># For now only common little-endian documents are handled correctly</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_FATAL, <span class="stringliteral">"incorrect ByteOrder in OLE header"</span>)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&nbsp;            <span class="comment"># TODO: add big-endian support for documents created on Mac ?</span></div><div class="line"><a name="l00939"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">  939</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a> = 2**self.SectorShift</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"SectorSize   = %d"</span> % self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a> )</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [512, 4096]:</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"incorrect SectorSize in OLE header"</span>)</div><div class="line"><a name="l00943"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">  943</a></span>&nbsp;        <span class="keywordflow">if</span> (self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">DllVersion</a>==3 <span class="keywordflow">and</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a>!=512) \</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&nbsp;        <span class="keywordflow">or</span> (self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">DllVersion</a>==4 <span class="keywordflow">and</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a>!=4096):</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"SectorSize does not match DllVersion in OLE header"</span>)</div><div class="line"><a name="l00946"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aff6c4f589be1e76dfb22bf56a84c38ab">  946</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aff6c4f589be1e76dfb22bf56a84c38ab">MiniSectorSize</a> = 2**self.MiniSectorShift</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"MiniSectorSize   = %d"</span> % self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aff6c4f589be1e76dfb22bf56a84c38ab">MiniSectorSize</a> )</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aff6c4f589be1e76dfb22bf56a84c38ab">MiniSectorSize</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [64]:</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"incorrect MiniSectorSize in OLE header"</span>)</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&nbsp;        <span class="keywordflow">if</span> self.Reserved != 0 <span class="keywordflow">or</span> self.Reserved1 != 0:</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"incorrect OLE header (non-null reserved bytes)"</span>)</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"csectDir     = %d"</span> % self.csectDir )</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&nbsp;        <span class="keywordflow">if</span> self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a>==512 <span class="keywordflow">and</span> self.csectDir!=0:</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">"incorrect csectDir in OLE header"</span>)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"csectFat     = %d"</span> % self.csectFat )</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"sectDirStart = %X"</span> % self.sectDirStart )</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"signature    = %d"</span> % self.signature )</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&nbsp;        <span class="comment"># Signature should be zero, BUT some implementations do not follow this</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&nbsp;        <span class="comment"># rule =&gt; only a potential defect:</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&nbsp;        <span class="keywordflow">if</span> self.signature != 0:</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_POTENTIAL, <span class="stringliteral">"incorrect OLE header (signature&gt;0)"</span>)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"MiniSectorCutoff = %d"</span> % self.MiniSectorCutoff )</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"MiniFatStart     = %X"</span> % self.MiniFatStart )</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"csectMiniFat     = %d"</span> % self.csectMiniFat )</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"sectDifStart     = %X"</span> % self.sectDifStart )</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"csectDif         = %d"</span> % self.csectDif )</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&nbsp;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&nbsp;        <span class="comment"># calculate the number of sectors in the file</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&nbsp;        <span class="comment"># (-1 because header doesn't count)</span></div><div class="line"><a name="l00970"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a1e73b962367d370f9d965311a5b386cd">  970</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a1e73b962367d370f9d965311a5b386cd">nb_sect</a> = ( (filesize + self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a>-1) / self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a>) - 1</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"Number of sectors in the file: %d"</span> % self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a1e73b962367d370f9d965311a5b386cd">nb_sect</a> )</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&nbsp;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&nbsp;        <span class="comment"># file clsid (probably never used, so we don't store it)</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&nbsp;        <span class="comment"># clsid = _clsid(header[8:24])</span></div><div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7ddb312b2ddbd9c2e57ecada64bc7b03">  975</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7ddb312b2ddbd9c2e57ecada64bc7b03">sectorsize</a> = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">SectorSize</a> <span class="comment">#1 &lt;&lt; i16(header, 30)</span></div><div class="line"><a name="l00976"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a2fd80ff7719c7e43afd9612a1396c3ac">  976</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a2fd80ff7719c7e43afd9612a1396c3ac">minisectorsize</a> = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aff6c4f589be1e76dfb22bf56a84c38ab">MiniSectorSize</a>  <span class="comment">#1 &lt;&lt; i16(header, 32)</span></div><div class="line"><a name="l00977"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9db833d09a1f77935bf99683a990ba0">  977</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9db833d09a1f77935bf99683a990ba0">minisectorcutoff</a> = self.MiniSectorCutoff <span class="comment"># i32(header, 56)</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&nbsp;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&nbsp;        <span class="comment"># check known streams for duplicate references (these are always in FAT,</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&nbsp;        <span class="comment"># never in MiniFAT):</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9b68be3a6363db728b452d1a7e09ac9">_check_duplicate_stream</a>(self.sectDirStart)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&nbsp;        <span class="comment"># check MiniFAT only if it is not empty:</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&nbsp;        <span class="keywordflow">if</span> self.csectMiniFat:</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9b68be3a6363db728b452d1a7e09ac9">_check_duplicate_stream</a>(self.MiniFatStart)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&nbsp;        <span class="comment"># check DIFAT only if it is not empty:</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&nbsp;        <span class="keywordflow">if</span> self.csectDif:</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9b68be3a6363db728b452d1a7e09ac9">_check_duplicate_stream</a>(self.sectDifStart)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&nbsp;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&nbsp;        <span class="comment"># Load file allocation tables</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a600481e940d2d6d66326e34b7068ddc4">loadfat</a>(header)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&nbsp;        <span class="comment"># Load direcory.  This sets both the direntries list (ordered by sid)</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&nbsp;        <span class="comment"># and the root (ordered by hierarchy) members.</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&nbsp;        self.loaddirectory(self.sectDirStart)<span class="comment">#i32(header, 48))</span></div><div class="line"><a name="l00994"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5ca8fd60ea1f971e3f963fce5fd78cee">  994</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5ca8fd60ea1f971e3f963fce5fd78cee">ministream</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00995"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#adb15ece05dc5f39c176c4f8b1a85f6e7">  995</a></span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#adb15ece05dc5f39c176c4f8b1a85f6e7">minifatsect</a> = self.MiniFatStart <span class="comment">#i32(header, 60)</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&nbsp;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&nbsp;</div><div class="line"><a name="l00998"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a663c091f9c2e3bfe7c57a0a3609b88c6">  998</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a663c091f9c2e3bfe7c57a0a3609b88c6">close</a>(self):</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&nbsp;<span class="stringliteral">        close the OLE file, to release the file object</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">fp</a>.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a663c091f9c2e3bfe7c57a0a3609b88c6">close</a>()</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&nbsp;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&nbsp;</div><div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9b68be3a6363db728b452d1a7e09ac9"> 1005</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9b68be3a6363db728b452d1a7e09ac9">_check_duplicate_stream</a>(self, first_sect, minifat=False):</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&nbsp;<span class="stringliteral">        Checks if a stream has not been already referenced elsewhere.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&nbsp;<span class="stringliteral">        This method should only be called once for each known stream, and only</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&nbsp;<span class="stringliteral">        if stream size is not null.</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&nbsp;<span class="stringliteral">        first_sect: index of first sector of the stream in FAT</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&nbsp;<span class="stringliteral">        minifat: if True, stream is located in the MiniFAT, else in the FAT</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&nbsp;        <span class="keywordflow">if</span> minifat:</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'_check_duplicate_stream: sect=%d in MiniFAT'</span> % first_sect)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&nbsp;            used_streams = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ad568d426eedc14ba3b447341c8b9bbaa">_used_streams_minifat</a></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'_check_duplicate_stream: sect=%d in FAT'</span> % first_sect)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&nbsp;            <span class="comment"># some values can be safely ignored (not a real stream):</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&nbsp;            <span class="keywordflow">if</span> first_sect <span class="keywordflow">in</span> (DIFSECT,FATSECT,ENDOFCHAIN,FREESECT):</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&nbsp;                <span class="keywordflow">return</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&nbsp;            used_streams = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a4cbbcb333e7d637d2ac89ec48162d968">_used_streams_fat</a></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&nbsp;        <span class="comment">#TODO: would it be more efficient using a dict or hash values, instead</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&nbsp;        <span class="comment">#      of a list of long ?</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&nbsp;        <span class="keywordflow">if</span> first_sect <span class="keywordflow">in</span> used_streams:</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">'Stream referenced twice'</span>)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&nbsp;            used_streams.append(first_sect)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&nbsp;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&nbsp;</div><div class="line"><a name="l01030"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af71cca412245531b86fe23766234c24c"> 1030</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af71cca412245531b86fe23766234c24c">sect2array</a>(self, sect):</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&nbsp;<span class="stringliteral">        convert a sector to an array of 32 bits unsigned integers,</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&nbsp;<span class="stringliteral">        swapping bytes on big endian CPUs such as PowerPC (old Macs)</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&nbsp;        a = array.array(UINT32, sect)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&nbsp;        <span class="comment"># if CPU is big endian, swap bytes:</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&nbsp;        <span class="keywordflow">if</span> sys.byteorder == <span class="stringliteral">'big'</span>:</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&nbsp;            a.byteswap()</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&nbsp;        <span class="keywordflow">return</span> a</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&nbsp;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&nbsp;</div><div class="line"><a name="l01042"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a74f12a8595f3e23247875cc3f44640ba"> 1042</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a74f12a8595f3e23247875cc3f44640ba">loadfat_sect</a>(self, sect):</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&nbsp;<span class="stringliteral">        Adds the indexes of the given sector to the FAT</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&nbsp;<span class="stringliteral">        sect: string containing the first FAT sector, or array of long integers</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&nbsp;<span class="stringliteral">        return: index of last FAT sector.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&nbsp;        <span class="comment"># a FAT sector is an array of ulong integers.</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&nbsp;        <span class="keywordflow">if</span> isinstance(sect, array.array):</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&nbsp;            <span class="comment"># if sect is already an array it is directly used</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&nbsp;            fat1 = sect</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&nbsp;            <span class="comment"># if it's a raw sector, it is parsed in an array</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&nbsp;            fat1 = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af71cca412245531b86fe23766234c24c">sect2array</a>(sect)</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&nbsp;            <span class="comment"># self.dumpsect(sect)</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&nbsp;        <span class="comment"># The FAT is a sector chain starting at the first index of itself.</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&nbsp;        <span class="keywordflow">for</span> isect <span class="keywordflow">in</span> fat1:</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&nbsp;            <span class="comment">#print "isect = %X" % isect</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&nbsp;            <span class="keywordflow">if</span> isect == ENDOFCHAIN <span class="keywordflow">or</span> isect == FREESECT:</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&nbsp;                <span class="comment"># the end of the sector chain has been reached</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&nbsp;                <span class="keywordflow">break</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&nbsp;            <span class="comment"># read the FAT sector</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&nbsp;            s = self.getsect(isect)</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&nbsp;            <span class="comment"># parse it as an array of 32 bits integers, and add it to the</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&nbsp;            <span class="comment"># global FAT array</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&nbsp;            nextfat = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af71cca412245531b86fe23766234c24c">sect2array</a>(s)</div><div class="line"><a name="l01067"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5bf2d8a5129348e6dc222542f0ed9aa6"> 1067</a></span>&nbsp;            self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5bf2d8a5129348e6dc222542f0ed9aa6">fat</a> = self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5bf2d8a5129348e6dc222542f0ed9aa6">fat</a> + nextfat</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&nbsp;        <span class="keywordflow">return</span> isect</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&nbsp;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&nbsp;</div><div class="line"><a name="l01071"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a600481e940d2d6d66326e34b7068ddc4"> 1071</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a600481e940d2d6d66326e34b7068ddc4">loadfat</a>(self, header):</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&nbsp;<span class="stringliteral">        Load the FAT table.</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&nbsp;        <span class="comment"># The header contains a sector  numbers</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&nbsp;        <span class="comment"># for the first 109 FAT sectors.  Additional sectors are</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&nbsp;        <span class="comment"># described by DIF blocks</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&nbsp;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&nbsp;        sect = header[76:512]</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"len(sect)=%d, so %d integers"</span> % (len(sect), len(sect)/4) )</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&nbsp;        <span class="comment">#fat    = []</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&nbsp;        <span class="comment"># [PL] FAT is an array of 32 bits unsigned ints, it's more effective</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&nbsp;        <span class="comment"># to use an array than a list in Python.</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&nbsp;        <span class="comment"># It's initialized as empty first:</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5bf2d8a5129348e6dc222542f0ed9aa6">fat</a> = array.array(UINT32)</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&nbsp;        self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a74f12a8595f3e23247875cc3f44640ba">loadfat_sect</a>(sect)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&nbsp;        <span class="comment">#self.dumpfat(self.fat)</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&nbsp;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&nbsp;        <span class="keywordflow">if</span> self.csectDif != 0:</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&nbsp;            <span class="comment"># [PL] There's a DIFAT because file is larger than 6.8MB</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&nbsp;            <span class="comment"># some checks just in case:</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&nbsp;            <span class="keywordflow">if</span> self.csectFat &lt;= 109:</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&nbsp;                <span class="comment"># there must be at least 109 blocks in header and the rest in</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&nbsp;                <span class="comment"># DIFAT, so number of sectors must be &gt;109.</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&nbsp;                self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_INCORRECT, <span class="stringliteral">'incorrect DIFAT, not enough sectors'</span>)</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&nbsp;            <span class="keywordflow">if</span> self.sectDifStart &gt;= self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a1e73b962367d370f9d965311a5b386cd">nb_sect</a>:</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&nbsp;                <span class="comment"># initial DIFAT block index must be valid</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&nbsp;                self.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">_raise_defect</a>(DEFECT_FATAL, <span class="stringliteral">'incorrect DIFAT, first index out of range'</span>)</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"DIFAT analysis..."</span> )</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&nbsp;            <span class="comment"># We compute the necessary number of DIFAT sectors :</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&nbsp;            <span class="comment"># (each DIFAT sector = 127 pointers + 1 towards next DIFAT sector)</span></div><div class="line"><a name="l01109"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a36566a0c7b3f15e84cb6276f91c12f61"> 1109</a></span>&nbsp;            nb_difat = (self.csectFat-109 + 126)/127</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"nb_difat = %d"</span> % nb_difat )</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&nbsp;            <span class="keywordflow">if</span> self.csectDif != nb_difat:</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect DIFAT'</span>)</div><div class="line"><a name="l01113"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a21cdfb0c8733cffc22aa4352e7764ae0"> 1113</a></span>&nbsp;            isect_difat = self.sectDifStart</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&nbsp;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(nb_difat):</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"DIFAT block %d, sector %X"</span> % (i, isect_difat) )</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&nbsp;                <span class="comment">#TODO: check if corresponding FAT SID = DIFSECT</span></div><div class="line"><a name="l01117"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ad75eca29f6f12b5a59108cfb1b8dc4ff"> 1117</a></span>&nbsp;                sector_difat = self.getsect(isect_difat)</div><div class="line"><a name="l01118"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aaec467b962cf593a00bdd89bccec0724"> 1118</a></span>&nbsp;                difat = self.sect2array(sector_difat)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&nbsp;                <span class="comment"># FIXME this errored out:</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&nbsp;                <span class="comment">#self.dumpsect(sector_difat)</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&nbsp;                self.loadfat_sect(difat[:127])</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&nbsp;                <span class="comment"># last DIFAT pointer is next DIFAT sector:</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&nbsp;                isect_difat = difat[127]</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>( <span class="stringliteral">"next DIFAT sector: %X"</span> % isect_difat )</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&nbsp;            <span class="comment"># checks:</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&nbsp;            <span class="keywordflow">if</span> isect_difat <span class="keywordflow">not</span> <span class="keywordflow">in</span> [ENDOFCHAIN, FREESECT]:</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&nbsp;                <span class="comment"># last DIFAT pointer value must be ENDOFCHAIN or FREESECT</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">'incorrect end of DIFAT'</span>)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&nbsp;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&nbsp;        <span class="keywordflow">if</span> len(self.fat) &gt; self.nb_sect:</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'len(fat)=%d, shrunk to nb_sect=%d'</span> % (len(self.fat), self.nb_sect))</div><div class="line"><a name="l01138"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac45d9cca2ee1dfbadf4dab4f33b4f6cd"> 1138</a></span>&nbsp;            self.fat = self.fat[:int(self.nb_sect)]</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'\nFAT:'</span>)</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&nbsp;        <span class="comment">#self.dumpfat(self.fat)</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&nbsp;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&nbsp;</div><div class="line"><a name="l01143"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af4eb965a4f87980b47523e8a816fff2e"> 1143</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af4eb965a4f87980b47523e8a816fff2e">loadminifat</a>(self):</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&nbsp;<span class="stringliteral">        Load the MiniFAT table.</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&nbsp;        <span class="comment"># MiniFAT is stored in a standard  sub-stream, pointed to by a header</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&nbsp;        <span class="comment"># field.</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&nbsp;        <span class="comment"># NOTE: there are two sizes to take into account for this stream:</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&nbsp;        <span class="comment"># 1) Stream size is calculated according to the number of sectors</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&nbsp;        <span class="comment">#    declared in the OLE header. This allocated stream may be more than</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&nbsp;        <span class="comment">#    needed to store the actual sector indexes.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&nbsp;        <span class="comment"># (self.csectMiniFat is the number of sectors of size self.SectorSize)</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&nbsp;        stream_size = self.csectMiniFat * self.SectorSize</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&nbsp;        <span class="comment"># 2) Actually used size is calculated by dividing the MiniStream size</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&nbsp;        <span class="comment">#    (given by root entry size) by the size of mini sectors, *4 for</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&nbsp;        <span class="comment">#    32 bits indexes:</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&nbsp;        nb_minisectors = (self.root.size + self.MiniSectorSize-1) / self.MiniSectorSize</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&nbsp;        used_size = nb_minisectors * 4</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'loadminifat(): minifatsect=%d, nb FAT sectors=%d, used_size=%d, stream_size=%d, nb MiniSectors=%d'</span> %</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&nbsp;            (self.minifatsect, self.csectMiniFat, used_size, stream_size, nb_minisectors))</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&nbsp;        <span class="keywordflow">if</span> used_size &gt; stream_size:</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&nbsp;            <span class="comment"># This is not really a problem, but may indicate a wrong implementation:</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&nbsp;            self._raise_defect(DEFECT_INCORRECT, <span class="stringliteral">'OLE MiniStream is larger than MiniFAT'</span>)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&nbsp;        <span class="comment"># In any case, first read stream_size:</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&nbsp;        s = self._open(self.minifatsect, stream_size, force_FAT=<span class="keyword">True</span>).read()</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&nbsp;        <span class="comment">#[PL] Old code replaced by an array:</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&nbsp;        <span class="comment">#self.minifat = map(lambda i, s=s: i32(s, i), range(0, len(s), 4))</span></div><div class="line"><a name="l01169"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a36bab6ee7801ee6cdb463a20dea24759"> 1169</a></span>&nbsp;        self.minifat = self.sect2array(s)</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&nbsp;        <span class="comment"># Then shrink the array to used size, to avoid indexes out of MiniStream:</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'MiniFAT shrunk from %d to %d sectors'</span> % (len(self.minifat), nb_minisectors))</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&nbsp;        self.minifat = self.minifat[:int(nb_minisectors)]</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'loadminifat(): len=%d'</span> % len(self.minifat))</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'\nMiniFAT:'</span>)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&nbsp;        <span class="comment"># self.dumpfat(self.minifat)</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&nbsp;</div><div class="line"><a name="l01177"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a32db4053d07a95313039b9eab1bfd3f7"> 1177</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a32db4053d07a95313039b9eab1bfd3f7">getsect</a>(self, sect):</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&nbsp;<span class="stringliteral">        Read given sector from file on disk.</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&nbsp;<span class="stringliteral">        sect: sector index</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&nbsp;<span class="stringliteral">        returns a string containing the sector data.</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&nbsp;        <span class="comment"># [PL] this original code was wrong when sectors are 4KB instead of</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&nbsp;        <span class="comment"># 512 bytes:</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&nbsp;        <span class="comment">#self.fp.seek(512 + self.sectorsize * sect)</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&nbsp;        <span class="comment">#[PL]: added safety checks:</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&nbsp;        <span class="comment">#print "getsect(%X)" % sect</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&nbsp;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&nbsp;            self.fp.seek(self.sectorsize * (sect+1))</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&nbsp;        <span class="keywordflow">except</span>:</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'getsect(): sect=%X, seek=%d, filesize=%d'</span> %</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&nbsp;                (sect, self.sectorsize*(sect+1), self._filesize))</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&nbsp;            self._raise_defect(DEFECT_FATAL, <span class="stringliteral">'OLE sector index out of range'</span>)</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&nbsp;        sector = self.fp.read(self.sectorsize)</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&nbsp;        <span class="keywordflow">if</span> len(sector) != self.sectorsize:</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&nbsp;            <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'getsect(): sect=%X, read=%d, sectorsize=%d'</span> %</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&nbsp;                (sect, len(sector), self.sectorsize))</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&nbsp;            self._raise_defect(DEFECT_FATAL, <span class="stringliteral">'incomplete OLE sector'</span>)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&nbsp;        <span class="keywordflow">return</span> sector</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&nbsp;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&nbsp;</div><div class="line"><a name="l01202"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#adf25fd6006038fb5011fe6885ee27721"> 1202</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#adf25fd6006038fb5011fe6885ee27721">loaddirectory</a>(self, sect):</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&nbsp;<span class="stringliteral">        Load the directory.</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&nbsp;<span class="stringliteral">        sect: sector index of directory stream.</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&nbsp;        <span class="comment"># The directory is  stored in a standard</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&nbsp;        <span class="comment"># substream, independent of its size.</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&nbsp;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&nbsp;        <span class="comment"># open directory stream as a read-only file:</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&nbsp;        <span class="comment"># (stream size is not known in advance)</span></div><div class="line"><a name="l01212"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aa50d426da7315fd216f3e8575a34d999"> 1212</a></span>&nbsp;        self.directory_fp = self._open(sect)</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&nbsp;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&nbsp;        <span class="comment">#[PL] to detect malformed documents and avoid DoS attacks, the maximum</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&nbsp;        <span class="comment"># number of directory entries can be calculated:</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&nbsp;        max_entries = self.directory_fp.size / 128</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'loaddirectory: size=%d, max_entries=%d'</span> %</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&nbsp;            (self.directory_fp.size, max_entries))</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&nbsp;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&nbsp;        <span class="comment"># Create list of directory entries</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&nbsp;        <span class="comment">#self.direntries = []</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&nbsp;        <span class="comment"># We start with a list of "None" object</span></div><div class="line"><a name="l01223"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aa61f67eb1531cea222a662299f3ed33d"> 1223</a></span>&nbsp;        self.direntries = [<span class="keywordtype">None</span>] * int(max_entries)</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&nbsp;</div><div class="line"><a name="l01230"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#acbb1f3837d00ea700e10b0ef6bfcb67c"> 1230</a></span>&nbsp;        root_entry = self._load_direntry(0)</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&nbsp;        <span class="comment"># Root entry is the first entry:</span></div><div class="line"><a name="l01232"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ae604c9a1e221fc8c974c65cd448accd8"> 1232</a></span>&nbsp;        self.root = self.direntries[0]</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&nbsp;        <span class="comment"># read and build all storage trees, starting from the root:</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&nbsp;        self.root.build_storage_tree()</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&nbsp;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&nbsp;</div><div class="line"><a name="l01237"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a45a0bd5a6df12d5abc3ad3c866411705"> 1237</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a45a0bd5a6df12d5abc3ad3c866411705">_load_direntry</a> (self, sid):</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&nbsp;<span class="stringliteral">        Load a directory entry from the directory.</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&nbsp;<span class="stringliteral">        This method should only be called once for each storage/stream when</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&nbsp;<span class="stringliteral">        loading the directory.</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&nbsp;<span class="stringliteral">        sid: index of storage/stream in the directory.</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&nbsp;<span class="stringliteral">        return: a _OleDirectoryEntry object</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&nbsp;<span class="stringliteral">        raise: IOError if the entry has always been referenced.</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&nbsp;        <span class="comment"># check if SID is OK:</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&nbsp;        <span class="keywordflow">if</span> sid&lt;0 <span class="keywordflow">or</span> sid&gt;=len(self.direntries):</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&nbsp;            self._raise_defect(DEFECT_FATAL, <span class="stringliteral">"OLE directory index out of range"</span>)</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&nbsp;        <span class="comment"># check if entry was already referenced:</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&nbsp;        <span class="keywordflow">if</span> self.direntries[sid] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&nbsp;            self._raise_defect(DEFECT_INCORRECT,</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&nbsp;                <span class="stringliteral">"double reference for OLE stream/storage"</span>)</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&nbsp;            <span class="comment"># if exception not raised, return the object</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&nbsp;            <span class="keywordflow">return</span> self.direntries[sid]</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&nbsp;        self.directory_fp.seek(sid * 128)</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&nbsp;        entry = self.directory_fp.read(128)</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&nbsp;        self.direntries[sid] = <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html">_OleDirectoryEntry</a>(entry, sid, self)</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&nbsp;        <span class="keywordflow">return</span> self.direntries[sid]</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&nbsp;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&nbsp;</div><div class="line"><a name="l01261"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a3f18102064aa23faccf4f2b69b5f92c1"> 1261</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a3f18102064aa23faccf4f2b69b5f92c1">dumpdirectory</a>(self):</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&nbsp;<span class="stringliteral">        Dump directory (for debugging only)</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&nbsp;        self.root.<a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/gpg2john_8c.html#ae9081ab6a16fd7c562b43c47a994be36">dump</a>()</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&nbsp;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&nbsp;</div><div class="line"><a name="l01268"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a03c0a0291f52aff1413db5bbd5e7cef3"> 1268</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a03c0a0291f52aff1413db5bbd5e7cef3">_open</a>(self, start, size = 0x7FFFFFFF, force_FAT=False):</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&nbsp;<span class="stringliteral">        Open a stream, either in FAT or MiniFAT according to its size.</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&nbsp;<span class="stringliteral">        (openstream helper)</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&nbsp;<span class="stringliteral">        start: index of first sector</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&nbsp;<span class="stringliteral">        size: size of stream (or nothing if size is unknown)</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&nbsp;<span class="stringliteral">        force_FAT: if False (default), stream will be opened in FAT or MiniFAT</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&nbsp;<span class="stringliteral">                   according to size. If True, it will always be opened in FAT.</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&nbsp;        <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'OleFileIO.open(): sect=%d, size=%d, force_FAT=%s'</span> %</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&nbsp;            (start, size, str(force_FAT)))</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&nbsp;        <span class="comment"># stream size is compared to the MiniSectorCutoff threshold:</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&nbsp;        <span class="keywordflow">if</span> size &lt; self.minisectorcutoff <span class="keywordflow">and</span> <span class="keywordflow">not</span> force_FAT:</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&nbsp;            <span class="comment"># ministream object</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&nbsp;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.ministream:</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&nbsp;                <span class="comment"># load MiniFAT if it wasn't already done:</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&nbsp;                self.loadminifat()</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&nbsp;                <span class="comment"># The first sector index of the miniFAT stream is stored in the</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&nbsp;                <span class="comment"># root directory entry:</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&nbsp;                size_ministream = self.root.size</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&nbsp;                <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">debug</a>(<span class="stringliteral">'Opening MiniStream: sect=%d, size=%d'</span> %</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&nbsp;                    (self.root.isectStart, size_ministream))</div><div class="line"><a name="l01291"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a57363670a72aa39244b366ad0d8dde0e"> 1291</a></span>&nbsp;                self.ministream = self._open(self.root.isectStart,</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&nbsp;                    size_ministream, force_FAT=<span class="keyword">True</span>)</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&nbsp;            <span class="keywordflow">return</span> <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html">_OleStream</a>(self.ministream, start, size, 0,</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&nbsp;                              self.minisectorsize, self.minifat,</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&nbsp;                              self.ministream.size)</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&nbsp;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&nbsp;            <span class="comment"># standard stream</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&nbsp;            <span class="keywordflow">return</span> <a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html">_OleStream</a>(self.fp, start, size, 512,</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&nbsp;                              self.sectorsize, self.fat, self._filesize)</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&nbsp;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&nbsp;</div><div class="line"><a name="l01302"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a1becfc0f80107df104ea0bcc9534e2de"> 1302</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a1becfc0f80107df104ea0bcc9534e2de">_list</a>(self, files, prefix, node):</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&nbsp;<span class="stringliteral">        (listdir helper)</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&nbsp;<span class="stringliteral">        files: list of files to fill in</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&nbsp;<span class="stringliteral">        prefix: current location in storage tree (list of names)</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&nbsp;<span class="stringliteral">        node: current node (_OleDirectoryEntry object)</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&nbsp;        prefix = prefix + [node.name]</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&nbsp;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> node.kids:</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&nbsp;            <span class="keywordflow">if</span> entry.kids:</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&nbsp;                self._list(files, prefix, entry)</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&nbsp;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&nbsp;                files.append(prefix[1:] + [entry.name])</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&nbsp;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&nbsp;</div><div class="line"><a name="l01317"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2bc9e9e28b19d623e7e9e97472d937f9"> 1317</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2bc9e9e28b19d623e7e9e97472d937f9">listdir</a>(self):</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&nbsp;<span class="stringliteral">        Return a list of streams stored in this file</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&nbsp;        files = []</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&nbsp;        self._list(files, [], self.root)</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&nbsp;        <span class="keywordflow">return</span> files</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&nbsp;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&nbsp;</div><div class="line"><a name="l01326"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac5189f5eda6f15da77ce92e9a44d7c0d"> 1326</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac5189f5eda6f15da77ce92e9a44d7c0d">_find</a>(self, filename):</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&nbsp;<span class="stringliteral">        Returns directory entry of given filename. (openstream helper)</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&nbsp;<span class="stringliteral">        Note: this method is case-insensitive.</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&nbsp;<span class="stringliteral">        filename: path of stream in storage tree (except root entry), either:</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&nbsp;<span class="stringliteral">            - a string using Unix path syntax, for example:</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&nbsp;<span class="stringliteral">              'storage_1/storage_1.2/stream'</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&nbsp;<span class="stringliteral">            - a list of storage filenames, path to the desired stream/storage.</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&nbsp;<span class="stringliteral">              Example: ['storage_1', 'storage_1.2', 'stream']</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&nbsp;<span class="stringliteral">        return: sid of requested filename</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&nbsp;<span class="stringliteral">        raise IOError if file not found</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&nbsp;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&nbsp;        <span class="comment">#filename = filename.decode()</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&nbsp;        <span class="comment"># if filename is a string instead of a list, split it on slashes to</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&nbsp;        <span class="comment"># convert to a list:</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&nbsp;        filename = filename.split(<span class="stringliteral">'/'</span>)</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&nbsp;        <span class="comment"># walk across storage tree, following given path:</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&nbsp;        node = self.root</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&nbsp;        <span class="keywordflow">for</span> name <span class="keywordflow">in</span> filename:</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&nbsp;            <span class="keywordflow">for</span> kid <span class="keywordflow">in</span> node.kids:</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&nbsp;                <span class="keywordflow">if</span> kid.name.lower() == name.lower():</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&nbsp;                    <span class="keywordflow">break</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&nbsp;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&nbsp;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">"file not found"</span>)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&nbsp;            node = kid</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&nbsp;        <span class="keywordflow">return</span> node.sid</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&nbsp;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&nbsp;</div><div class="line"><a name="l01356"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a8b79f0bd91baf3143c2401b0c6c6bb1c"> 1356</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a8b79f0bd91baf3143c2401b0c6c6bb1c">openstream</a>(self, filename):</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&nbsp;<span class="stringliteral">        Open a stream as a read-only file object (StringIO).</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&nbsp;<span class="stringliteral">        filename: path of stream in storage tree (except root entry), either:</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&nbsp;<span class="stringliteral">            - a string using Unix path syntax, for example:</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&nbsp;<span class="stringliteral">              'storage_1/storage_1.2/stream'</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&nbsp;<span class="stringliteral">            - a list of storage filenames, path to the desired stream/storage.</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&nbsp;<span class="stringliteral">              Example: ['storage_1', 'storage_1.2', 'stream']</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&nbsp;<span class="stringliteral">        return: file object (read-only)</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&nbsp;<span class="stringliteral">        raise IOError if filename not found, or if this is not a stream.</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&nbsp;        sid = self._find(filename)</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&nbsp;        entry = self.direntries[sid]</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&nbsp;        <span class="keywordflow">if</span> entry.entry_type != STGTY_STREAM:</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&nbsp;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">"this file is not a stream"</span>)</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&nbsp;        <span class="keywordflow">return</span> self._open(entry.isectStart, entry.size)</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&nbsp;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&nbsp;</div><div class="line"><a name="l01375"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a6b7c610ef20c4f95cb14d61942df3beb"> 1375</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a6b7c610ef20c4f95cb14d61942df3beb">get_type</a>(self, filename):</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&nbsp;<span class="stringliteral">        Test if given filename exists as a stream or a storage in the OLE</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&nbsp;<span class="stringliteral">        container, and return its type.</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&nbsp;<span class="stringliteral">        filename: path of stream in storage tree. (see openstream for syntax)</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&nbsp;<span class="stringliteral">        return: False if object does not exist, its entry type (&gt;0) otherwise:</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&nbsp;<span class="stringliteral">            - STGTY_STREAM: a stream</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&nbsp;<span class="stringliteral">            - STGTY_STORAGE: a storage</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&nbsp;<span class="stringliteral">            - STGTY_ROOT: the root entry</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&nbsp;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&nbsp;            sid = self._find(filename)</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&nbsp;            entry = self.direntries[sid]</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&nbsp;            <span class="keywordflow">return</span> entry.entry_type</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&nbsp;        <span class="keywordflow">except</span>:</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&nbsp;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&nbsp;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&nbsp;</div><div class="line"><a name="l01394"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a763261d9435a624c49346f6c49cd0656"> 1394</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a763261d9435a624c49346f6c49cd0656">exists</a>(self, filename):</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&nbsp;<span class="stringliteral">        Test if given filename exists as a stream or a storage in the OLE</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&nbsp;<span class="stringliteral">        container.</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&nbsp;<span class="stringliteral">        filename: path of stream in storage tree. (see openstream for syntax)</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&nbsp;<span class="stringliteral">        return: True if object exist, else False.</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&nbsp;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&nbsp;            sid = self._find(filename)</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&nbsp;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&nbsp;        <span class="keywordflow">except</span>:</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&nbsp;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&nbsp;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&nbsp;</div><div class="line"><a name="l01409"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a3d111eeff9847192161501264c6b0a22"> 1409</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a3d111eeff9847192161501264c6b0a22">get_size</a>(self, filename):</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&nbsp;<span class="stringliteral">        Return size of a stream in the OLE container, in bytes.</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&nbsp;<span class="stringliteral">        filename: path of stream in storage tree (see openstream for syntax)</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&nbsp;<span class="stringliteral">        return: size in bytes (long integer)</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&nbsp;<span class="stringliteral">        raise: IOError if file not found, TypeError if this is not a stream.</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&nbsp;        sid = self._find(filename)</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&nbsp;        entry = self.direntries[sid]</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&nbsp;        <span class="keywordflow">if</span> entry.entry_type != STGTY_STREAM:</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&nbsp;            <span class="comment">#TODO: Should it return zero instead of raising an exception ?</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&nbsp;            <span class="keywordflow">raise</span> TypeError(<span class="stringliteral">'object is not an OLE stream'</span>)</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&nbsp;        <span class="keywordflow">return</span> entry.size</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&nbsp;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&nbsp;</div><div class="line"><a name="l01425"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac55583c6f72a9e618c0af0ac7fb5ea7f"> 1425</a></span>&nbsp;    <span class="keyword">def </span><a class="code" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac55583c6f72a9e618c0af0ac7fb5ea7f">get_rootentry_name</a>(self):</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&nbsp;<span class="stringliteral">        Return root entry name. Should usually be 'Root Entry' or 'R' in most</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&nbsp;<span class="stringliteral">        implementations.</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&nbsp;<span class="stringliteral">        return self.root.name</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01433"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a8f0ad4b8b28d8f16302638970e0b3f9f"> 1433</a></span>&nbsp;<span class="stringliteral">    def getproperties(self, filename):</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&nbsp;<span class="stringliteral">        """</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&nbsp;        Return properties described <span class="keywordflow">in</span> substream.</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&nbsp;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&nbsp;        filename: path of stream <span class="keywordflow">in</span> storage tree (see openstream <span class="keywordflow">for</span> syntax)</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&nbsp;        <span class="keywordflow">return</span>: a dictionary of values indexed by id (integer)</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&nbsp;        <span class="stringliteral">"""</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&nbsp;<span class="stringliteral">        fp = self.openstream(filename)</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&nbsp;<span class="stringliteral">        data = {}</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&nbsp;<span class="stringliteral">        # header</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&nbsp;<span class="stringliteral">        s = fp.read(28)</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&nbsp;<span class="stringliteral">        # clsid = _clsid(s[8:24])</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&nbsp;<span class="stringliteral">        # format id</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&nbsp;<span class="stringliteral">        s = fp.read(20)</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&nbsp;<span class="stringliteral">        # fmtid = _clsid(s[:16])</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&nbsp;<span class="stringliteral">        fp.seek(i32(s, 16))</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&nbsp;<span class="stringliteral">        # get section</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&nbsp;<span class="stringliteral">        s = b"****" + fp.read(i32(fp.read(4))-4)</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&nbsp;<span class="stringliteral">        encoding = "ERROR"</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&nbsp;<span class="stringliteral">        for i in range(i32(s, 4)):</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&nbsp;<span class="stringliteral">            id = i32(s, 8+i*8)</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&nbsp;<span class="stringliteral">            offset = i32(s, 12+i*8)</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&nbsp;<span class="stringliteral">            type = i32(s, offset)</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&nbsp;<span class="stringliteral">            debug ('property id=%d: type=%d offset=%X' % (id, type, offset))</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&nbsp;<span class="stringliteral">            # test for common types first (should perhaps use</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&nbsp;<span class="stringliteral">            # a dictionary instead?)</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&nbsp;<span class="stringliteral">            if type == VT_I2:</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&nbsp;<span class="stringliteral">                value = i16(s, offset+4)</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&nbsp;<span class="stringliteral">                if (id == 1):</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&nbsp;<span class="stringliteral">                    if (value == 65001):</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&nbsp;<span class="stringliteral">                        encoding = "utf8"</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&nbsp;<span class="stringliteral">                    else:</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&nbsp;<span class="stringliteral">                        encoding = "CP" + str(value)</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&nbsp;<span class="stringliteral">                    debug ("New encoding: %s" % encoding)</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&nbsp;<span class="stringliteral">                if value &gt;= 32768:</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&nbsp;<span class="stringliteral">                    value = value - 65536</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&nbsp;<span class="stringliteral">            elif type == VT_UI2:</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&nbsp;<span class="stringliteral">                value = i16(s, offset+4)</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&nbsp;<span class="stringliteral">            elif type in (VT_I4, VT_ERROR):</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&nbsp;<span class="stringliteral">                value = i32(s, offset+4)</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&nbsp;<span class="stringliteral">            elif type == VT_UI4:</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&nbsp;<span class="stringliteral">                value = i32(s, offset+4) # FIXME</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&nbsp;<span class="stringliteral">            elif type in (VT_BSTR, VT_LPSTR):</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&nbsp;<span class="stringliteral">                count = i32(s, offset+4)</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&nbsp;<span class="stringliteral">                value = s[offset+8:offset+8+count-1].decode(encoding)</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&nbsp;<span class="stringliteral">            elif type == VT_BLOB:</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&nbsp;<span class="stringliteral">                count = i32(s, offset+4)</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&nbsp;<span class="stringliteral">                value = s[offset+8:offset+8+count]</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&nbsp;<span class="stringliteral">            elif type == VT_LPWSTR:</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&nbsp;<span class="stringliteral">                count = i32(s, offset+4)</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&nbsp;<span class="stringliteral">                value = s[offset+8:offset+8+count*2].decode("utf-16le")</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&nbsp;<span class="stringliteral">            elif type == VT_FILETIME:</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&nbsp;<span class="stringliteral">                value = i32(s, offset+4) + ((i32(s, offset+8))&lt;&lt;32)</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&nbsp;<span class="stringliteral">                # FIXME: this is a 64-bit int: "number of 100ns periods</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&nbsp;<span class="stringliteral">                # since Jan 1,1601".  Should map this to Python time</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&nbsp;<span class="stringliteral">                value = value / 10000000 # seconds</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&nbsp;<span class="stringliteral">            elif type == VT_UI1:</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&nbsp;<span class="stringliteral">                value = ord(s[offset+4])</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&nbsp;<span class="stringliteral">            elif type == VT_CLSID:</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&nbsp;<span class="stringliteral">                value = _clsid(s[offset+4:offset+20])</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&nbsp;<span class="stringliteral">            elif type == VT_CF:</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&nbsp;<span class="stringliteral">                count = i32(s, offset+4)</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&nbsp;<span class="stringliteral">                value = s[offset+8:offset+8+count]</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&nbsp;<span class="stringliteral">            else:</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&nbsp;<span class="stringliteral">                value = None  # everything else yields "None"</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&nbsp;<span class="stringliteral">            data[id] = value</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&nbsp;<span class="stringliteral">        return data</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&nbsp;<span class="stringliteral">##### library ends, program starts #####</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&nbsp;<span class="stringliteral">from struct import unpack</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&nbsp;<span class="stringliteral">import binascii</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01519"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a6628ba253e23e621abe0f6dd81168d1d"> 1519</a></span>&nbsp;<span class="stringliteral">def find_rc4_passinfo_xls(filename, stream):</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&nbsp;<span class="stringliteral">    """</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&nbsp;    Initial version of this function was based on a blog entry posted by</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&nbsp;    Worawit (sleepya) at http://auntitled.blogspot.in site.</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&nbsp;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&nbsp;    Since then this function has been heavily modified <span class="keywordflow">and</span> extended.</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&nbsp;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&nbsp;    http://msdn.microsoft.com/en-us/library/dd908560%28v=office.12%29</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&nbsp;    http://msdn.microsoft.com/en-us/library/dd920360%28v=office.12%29</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&nbsp;    <span class="stringliteral">"""</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&nbsp;<span class="stringliteral">    while True:</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&nbsp;<span class="stringliteral">        pos = stream.tell()</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&nbsp;<span class="stringliteral">        if pos &gt;= stream.size:</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&nbsp;<span class="stringliteral">            break  # eof</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&nbsp;<span class="stringliteral">        type = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&nbsp;<span class="stringliteral">        length = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&nbsp;<span class="stringliteral">        data = stream.read(length)</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&nbsp;<span class="stringliteral">        if type == 0x2f:  # FILEPASS</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&nbsp;<span class="stringliteral">            if data[0:2] == b"\x00\x00":  # XOR obfuscation</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&nbsp;<span class="stringliteral">                sys.stderr.write("%s : XOR obfuscation detected, key : %s, hash : %s\n" % \</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&nbsp;<span class="stringliteral">                    (filename, binascii.hexlify(data[2:4]), binascii.hexlify(data[4:6])))</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&nbsp;<span class="stringliteral">            elif data[0:6] == b'\x01\x00\x01\x00\x01\x00':</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&nbsp;<span class="stringliteral">                # RC4 encryption header structure</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&nbsp;<span class="stringliteral">                data = data[6:]</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&nbsp;<span class="stringliteral">                salt = data[:16]</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&nbsp;<span class="stringliteral">                verifier = data[16:32]</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&nbsp;<span class="stringliteral">                verifierHash = data[32:48]</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&nbsp;<span class="stringliteral">                return (salt, verifier, verifierHash)</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&nbsp;<span class="stringliteral">            elif data[0:4] == b'\x01\x00\x02\x00' or data[0:4] == b'\x01\x00\x03\x00':</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&nbsp;<span class="stringliteral">                # If RC4 CryptoAPI encryption is used, certain storages and streams are stored in Encryption Stream</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&nbsp;<span class="stringliteral">                stm = StringIO(data)</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&nbsp;<span class="stringliteral">                stm.read(2)  # unused</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&nbsp;<span class="stringliteral">                # RC4 CryptoAPI Encryption Header</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&nbsp;<span class="stringliteral">                unpack("&lt;h", stm.read(2))[0]  # major_version</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&nbsp;<span class="stringliteral">                unpack("&lt;h", stm.read(2))[0]  # minor_version</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # encryptionFlags</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&nbsp;<span class="stringliteral">                headerLength = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # skipFlags</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # sizeExtra</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # algId</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # algHashId</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&nbsp;<span class="stringliteral">                keySize = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&nbsp;<span class="stringliteral">                if keySize == 40:</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&nbsp;<span class="stringliteral">                    typ = 3</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&nbsp;<span class="stringliteral">                else:</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&nbsp;<span class="stringliteral">                    typ = 4</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # providerType</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # unused</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&nbsp;<span class="stringliteral">                unpack("&lt;I", stm.read(4))[0]  # unused</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&nbsp;<span class="stringliteral">                headerLength -= 4</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&nbsp;<span class="stringliteral">                CSPName = stm.read(headerLength)</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&nbsp;<span class="stringliteral">                provider = CSPName.decode('utf-16').lower()</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&nbsp;<span class="stringliteral">                # Encryption verifier</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&nbsp;<span class="stringliteral">                saltSize = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&nbsp;<span class="stringliteral">                assert(saltSize == 16)</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&nbsp;<span class="stringliteral">                salt = stm.read(saltSize)</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&nbsp;<span class="stringliteral">                encryptedVerifier = stm.read(16)</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&nbsp;<span class="stringliteral">                verifierHashSize = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&nbsp;<span class="stringliteral">                assert(verifierHashSize == 20)</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&nbsp;<span class="stringliteral">                encryptedVerifierHash = stm.read(verifierHashSize)</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&nbsp;<span class="stringliteral">                sys.stdout.write("%s:$oldoffice$%s*%s*%s*%s\n" % (os.path.basename(filename),</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&nbsp;<span class="stringliteral">                    typ, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&nbsp;<span class="stringliteral">                    binascii.hexlify(encryptedVerifier).decode("ascii"),</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&nbsp;<span class="stringliteral">                    binascii.hexlify(encryptedVerifierHash).decode("ascii")))</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&nbsp;<span class="stringliteral">    return None</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01597"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aa0f873346ba0a1570e66435f87d9ef1a"> 1597</a></span>&nbsp;<span class="stringliteral">def find_doc_type(filename, stream):</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&nbsp;<span class="stringliteral">    w_ident = stream.read(2)</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&nbsp;<span class="stringliteral">    assert(w_ident == b"\xec\xa5")</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&nbsp;<span class="stringliteral">    stream.read(9)  # unused</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&nbsp;<span class="stringliteral">    flags = ord(stream.read(1))</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&nbsp;<span class="stringliteral">    if (flags &amp; 1) != 0:</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&nbsp;<span class="stringliteral">        F = 1</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&nbsp;<span class="stringliteral">        F = 0</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&nbsp;<span class="stringliteral">    if (flags &amp; 128) != 0:</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&nbsp;<span class="stringliteral">        M = 1</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&nbsp;<span class="stringliteral">        M = 0</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&nbsp;<span class="stringliteral">    if F == 1 and M == 1:</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&nbsp;<span class="stringliteral">        stream.read(2)  # unused</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&nbsp;<span class="stringliteral">        i_key = stream.read(4)</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : XOR obfuscation detected, Password Verifier : %s\n" % \</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&nbsp;<span class="stringliteral">                (filename, binascii.hexlify(i_key)))</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&nbsp;<span class="stringliteral">        return True</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&nbsp;<span class="stringliteral">    if F == 0:</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : Document is not encrypted!\n" % (filename))</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&nbsp;<span class="stringliteral">        return True</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01621"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac6a7ddcbf1c1778ee63169c4999ee8ff"> 1621</a></span>&nbsp;<span class="stringliteral">def find_ppt_type(filename, stream):</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&nbsp;<span class="stringliteral">    # read CurrentUserRec's RecordHeader</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&nbsp;<span class="stringliteral">    stream.read(2)  # unused</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&nbsp;<span class="stringliteral">    unpack("&lt;h", stream.read(2))[0]  # recType</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # recLen</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&nbsp;<span class="stringliteral">    # read rest of CurrentUserRec</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # size</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # headerToken</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&nbsp;<span class="stringliteral">    offsetToCurrentEdit = unpack("&lt;L", stream.read(4))[0]</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&nbsp;<span class="stringliteral">    return offsetToCurrentEdit</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01633"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ad23284db5fb733b3b66346abcf046b75"> 1633</a></span>&nbsp;<span class="stringliteral">def find_rc4_passinfo_doc(filename, stream):</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&nbsp;<span class="stringliteral">    major_version = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&nbsp;<span class="stringliteral">    minor_version = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&nbsp;<span class="stringliteral">    if major_version == 1 or minor_version == 1:</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&nbsp;<span class="stringliteral">        data = stream.read(48)</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&nbsp;<span class="stringliteral">        salt = data[:16]</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&nbsp;<span class="stringliteral">        verifier = data[16:32]</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&nbsp;<span class="stringliteral">        verifierHash = data[32:48]</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&nbsp;<span class="stringliteral">        return (salt, verifier, verifierHash)</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&nbsp;<span class="stringliteral">    elif major_version &gt;= 2 and minor_version == 2:</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&nbsp;<span class="stringliteral">        # RC4 CryptoAPI Encryption Header</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # encryptionFlags</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&nbsp;<span class="stringliteral">        headerLength = unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # skipFlags</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # sizeExtra</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # algId</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # algHashId</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&nbsp;<span class="stringliteral">        keySize = unpack("&lt;I", stream.read(4))[0]  # keySize</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # providerType</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # unused</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # unused</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&nbsp;<span class="stringliteral">        CSPName = stream.read(headerLength)</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&nbsp;<span class="stringliteral">        provider = CSPName.decode('utf-16').lower()</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&nbsp;<span class="stringliteral">        if keySize == 128:</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&nbsp;<span class="stringliteral">            typ = 4</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&nbsp;<span class="stringliteral">        elif keySize == 40:</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&nbsp;<span class="stringliteral">            typ = 3</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&nbsp;<span class="stringliteral">        else:</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&nbsp;<span class="stringliteral">            sys.stderr.write("%s : invalid keySize\n" % filename)</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&nbsp;<span class="stringliteral">        # Encryption verifier</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&nbsp;<span class="stringliteral">        saltSize = unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&nbsp;<span class="stringliteral">        assert(saltSize == 16)</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&nbsp;<span class="stringliteral">        salt = stream.read(saltSize)</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&nbsp;<span class="stringliteral">        encryptedVerifier = stream.read(16)</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&nbsp;<span class="stringliteral">        verifierHashSize = unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&nbsp;<span class="stringliteral">        assert(verifierHashSize == 20)</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&nbsp;<span class="stringliteral">        encryptedVerifierHash = stream.read(verifierHashSize)</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&nbsp;<span class="stringliteral">        if not have_summary:</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&nbsp;<span class="stringliteral">            sys.stdout.write("%s:$oldoffice$%s*%s*%s*%s\n" % (os.path.basename(filename),</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&nbsp;<span class="stringliteral">                typ, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&nbsp;<span class="stringliteral">                binascii.hexlify(encryptedVerifier).decode("ascii"),</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&nbsp;<span class="stringliteral">                binascii.hexlify(encryptedVerifierHash).decode("ascii")))</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&nbsp;<span class="stringliteral">        else:</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&nbsp;<span class="stringliteral">            sys.stdout.write("%s:$oldoffice$%s*%s*%s*%s:::%s::%s\n" % (os.path.basename(filename),</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&nbsp;<span class="stringliteral">                typ, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&nbsp;<span class="stringliteral">                binascii.hexlify(encryptedVerifier).decode("ascii"),</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&nbsp;<span class="stringliteral">                binascii.hexlify(encryptedVerifierHash).decode("ascii"), summary, filename))</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : Cannot find RC4 pass info, is document encrypted?\n" % filename)</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01695"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a6386a4d48a39d1ca16862a4cf3f24871"> 1695</a></span>&nbsp;<span class="stringliteral">def find_rc4_passinfo_ppt(filename, stream, offset):</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&nbsp;<span class="stringliteral">    stream.read(offset)  # unused</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&nbsp;<span class="stringliteral">    # read UserEditAtom's RecordHeader</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&nbsp;<span class="stringliteral">    stream.read(2)  # unused</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&nbsp;<span class="stringliteral">    recType = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&nbsp;<span class="stringliteral">    recLen = unpack("&lt;L", stream.read(4))[0]</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&nbsp;<span class="stringliteral">    if recLen != 32:</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : Document is not encrypted!\n" % (filename))</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&nbsp;<span class="stringliteral">        return</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&nbsp;<span class="stringliteral">    if recType != 0x0FF5:</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : Document is corrupt!\n" % (filename))</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&nbsp;<span class="stringliteral">        return</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&nbsp;<span class="stringliteral">    # read reset of UserEditAtom</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # lastSlideRef</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&nbsp;<span class="stringliteral">    unpack("&lt;h", stream.read(2))[0]  # version</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&nbsp;<span class="stringliteral">    ord(stream.read(1))  # minorVersion</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&nbsp;<span class="stringliteral">    ord(stream.read(1))  # majorVersion</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # offsetLastEdit</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&nbsp;<span class="stringliteral">    offsetPersistDirectory = unpack("&lt;L", stream.read(4))[0]</span></div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # docPersistIdRef</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&nbsp;<span class="stringliteral">    unpack("&lt;L", stream.read(4))[0]  # persistIdSeed</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&nbsp;<span class="stringliteral">    unpack("&lt;h", stream.read(2))[0]  # lastView</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&nbsp;<span class="stringliteral">    unpack("&lt;h", stream.read(2))[0]  # unused</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&nbsp;<span class="stringliteral">    encryptSessionPersistIdRef = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&nbsp;<span class="stringliteral">    # if( offset.LowPart &lt; userAtom.offsetPersistDirectory ||</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&nbsp;<span class="stringliteral">    # userAtom.offsetPersistDirectory &lt; userAtom.offsetLastEdit )</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&nbsp;<span class="stringliteral">    # goto CorruptFile;</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&nbsp;<span class="stringliteral">    # jump and read RecordHeader</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&nbsp;<span class="stringliteral">    stream.seek(offsetPersistDirectory, 0)</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&nbsp;<span class="stringliteral">    stream.read(2)  # unused</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&nbsp;<span class="stringliteral">    recType = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&nbsp;<span class="stringliteral">    recLen = unpack("&lt;L", stream.read(4))[0]</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&nbsp;<span class="stringliteral">    # BUGGY: PersistDirectoryAtom and PersistDirectoryEntry processing</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&nbsp;<span class="stringliteral">    i = 0</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&nbsp;<span class="stringliteral">    stream.read(4)  # unused</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&nbsp;<span class="stringliteral">    while i &lt; encryptSessionPersistIdRef:</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&nbsp;<span class="stringliteral">        i += 1</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&nbsp;<span class="stringliteral">        persistOffset = unpack("&lt;L", stream.read(4))[0]</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&nbsp;<span class="stringliteral">    # print persistOffset</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&nbsp;<span class="stringliteral">    # go to the offset of encryption header</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&nbsp;<span class="stringliteral">    stream.seek(persistOffset, 0)</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&nbsp;<span class="stringliteral">    # read RecordHeader</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&nbsp;<span class="stringliteral">    stream.read(2)  # unused</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&nbsp;<span class="stringliteral">    recType = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&nbsp;<span class="stringliteral">    recLen = unpack("&lt;L", stream.read(4))[0]</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&nbsp;<span class="stringliteral">    major_version = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&nbsp;<span class="stringliteral">    minor_version = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&nbsp;<span class="stringliteral">    if major_version &gt;= 2 and minor_version == 2:</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&nbsp;<span class="stringliteral">        # RC4 CryptoAPI Encryption Header</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # encryptionFlags</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&nbsp;<span class="stringliteral">        headerLength = unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # skipFlags</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # sizeExtra</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # algId</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # algHashId</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # keySize</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]  # providerType</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&nbsp;<span class="stringliteral">        CSPName = stream.read(headerLength)</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&nbsp;<span class="stringliteral">        provider = CSPName.decode('utf-16').lower()</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&nbsp;<span class="stringliteral">        if "strong" in provider:</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&nbsp;<span class="stringliteral">            typ = 4</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&nbsp;<span class="stringliteral">        else:</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&nbsp;<span class="stringliteral">            typ = 3</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&nbsp;<span class="stringliteral">        # Encryption verifier</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&nbsp;<span class="stringliteral">        saltSize = unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&nbsp;<span class="stringliteral">        assert(saltSize == 16)</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&nbsp;<span class="stringliteral">        salt = stream.read(saltSize)</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&nbsp;<span class="stringliteral">        encryptedVerifier = stream.read(16)</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&nbsp;<span class="stringliteral">        verifierHashSize = unpack("&lt;I", stream.read(4))[0]</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&nbsp;<span class="stringliteral">        assert(verifierHashSize == 20)</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&nbsp;<span class="stringliteral">        encryptedVerifierHash = stream.read(verifierHashSize)</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&nbsp;<span class="stringliteral">        sys.stdout.write("%s:$oldoffice$%s*%s*%s*%s\n" % (os.path.basename(filename),</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&nbsp;<span class="stringliteral">            typ, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&nbsp;<span class="stringliteral">            binascii.hexlify(encryptedVerifier).decode("ascii"),</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&nbsp;<span class="stringliteral">            binascii.hexlify(encryptedVerifierHash).decode("ascii")))</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : Cannot find RC4 pass info, is document encrypted?\n" % filename)</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&nbsp;<span class="stringliteral">from xml.etree.ElementTree import ElementTree</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&nbsp;<span class="stringliteral">import base64</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01788"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a78be64dcce1c79b358103344951f5be7"> 1788</a></span>&nbsp;<span class="stringliteral">def process_new_office(filename):</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&nbsp;<span class="stringliteral">    # detect version of new Office used by reading "EncryptionInfo" stream</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&nbsp;<span class="stringliteral">    ole = OleFileIO(filename)</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&nbsp;<span class="stringliteral">    stream = ole.openstream("EncryptionInfo")</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&nbsp;<span class="stringliteral">    major_version = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&nbsp;<span class="stringliteral">    minor_version = unpack("&lt;h", stream.read(2))[0]</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&nbsp;<span class="stringliteral">    encryptionFlags = unpack("&lt;I", stream.read(4))[0]  # encryptionFlags</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&nbsp;<span class="stringliteral">    if encryptionFlags == 16:  # fExternal</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : An external cryptographic provider is not supported!\n" % filename)</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&nbsp;<span class="stringliteral">        return -1</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&nbsp;<span class="stringliteral">    if major_version == 0x04 and minor_version == 0x04:</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&nbsp;<span class="stringliteral">        # Office 2010 and 2013 file detected</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&nbsp;<span class="stringliteral">        if encryptionFlags != 0x40:  # fAgile</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&nbsp;<span class="stringliteral">            sys.stderr.write("%s : The encryption flags are not consistent with the encryption type\n" % filename)</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&nbsp;<span class="stringliteral">            return -2</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&nbsp;<span class="stringliteral">        # rest of the data is in XML format</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&nbsp;<span class="stringliteral">        data = StringIO(stream.read())</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&nbsp;<span class="stringliteral">        tree = ElementTree()</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&nbsp;<span class="stringliteral">        tree.parse(data)</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&nbsp;<span class="stringliteral">        for node in tree.getiterator('{http://schemas.microsoft.com/office/2006/keyEncryptor/password}encryptedKey'):</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&nbsp;<span class="stringliteral">            spinCount = node.attrib.get("spinCount")</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&nbsp;<span class="stringliteral">            assert(spinCount)</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&nbsp;<span class="stringliteral">            saltSize = node.attrib.get("saltSize")</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&nbsp;<span class="stringliteral">            assert(saltSize)</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&nbsp;<span class="stringliteral">            blockSize = node.attrib.get("blockSize")</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&nbsp;<span class="stringliteral">            assert(blockSize)</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&nbsp;<span class="stringliteral">            keyBits = node.attrib.get("keyBits")</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&nbsp;<span class="stringliteral">            hashAlgorithm = node.attrib.get("hashAlgorithm")</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&nbsp;<span class="stringliteral">            if hashAlgorithm == "SHA1":</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&nbsp;<span class="stringliteral">                version = 2010</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&nbsp;<span class="stringliteral">            elif hashAlgorithm == "SHA512":</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&nbsp;<span class="stringliteral">                version = 2013</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&nbsp;<span class="stringliteral">            else:</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&nbsp;<span class="stringliteral">                sys.stderr.write("%s uses un-supported hashing algorithm %s, please file a bug! \n" \</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&nbsp;<span class="stringliteral">                        % (filename, hashAlgorithm))</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&nbsp;<span class="stringliteral">                return -3</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&nbsp;<span class="stringliteral">            cipherAlgorithm = node.attrib.get("cipherAlgorithm")</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&nbsp;<span class="stringliteral">            if not cipherAlgorithm.find("AES") &gt; -1:</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&nbsp;<span class="stringliteral">                sys.stderr.write("%s uses un-supported cipher algorithm %s, please file a bug! \n" \</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&nbsp;<span class="stringliteral">                    % (filename, cipherAlgorithm))</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&nbsp;<span class="stringliteral">                return -4</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&nbsp;<span class="stringliteral">            saltValue = node.attrib.get("saltValue")</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&nbsp;<span class="stringliteral">            assert(saltValue)</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&nbsp;<span class="stringliteral">            encryptedVerifierHashInput = node.attrib.get("encryptedVerifierHashInput")</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&nbsp;<span class="stringliteral">            encryptedVerifierHashValue = node.attrib.get("encryptedVerifierHashValue")</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&nbsp;<span class="stringliteral">            encryptedVerifierHashValue = binascii.hexlify(base64.decodestring(encryptedVerifierHashValue.encode()))</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&nbsp;<span class="stringliteral">            sys.stdout.write("%s:$office$*%d*%d*%d*%d*%s*%s*%s\n" % \</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&nbsp;<span class="stringliteral">                (os.path.basename(filename), version,</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&nbsp;<span class="stringliteral">                int(spinCount), int(keyBits), int(saltSize),</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&nbsp;<span class="stringliteral">                binascii.hexlify(base64.decodestring(saltValue.encode())).decode("ascii"),</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&nbsp;<span class="stringliteral">                binascii.hexlify(base64.decodestring(encryptedVerifierHashInput.encode())).decode("ascii"),</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&nbsp;<span class="stringliteral">                encryptedVerifierHashValue[0:64].decode("ascii")))</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&nbsp;<span class="stringliteral">            return 0</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&nbsp;<span class="stringliteral">        # Office 2007 file detected, process CryptoAPI Encryption Header</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&nbsp;<span class="stringliteral">        stm = stream</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&nbsp;<span class="stringliteral">        headerLength = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # skipFlags</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # sizeExtra</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # algId</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # algHashId</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&nbsp;<span class="stringliteral">        keySize = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # providerType</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # unused</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&nbsp;<span class="stringliteral">        unpack("&lt;I", stm.read(4))[0]  # unused</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&nbsp;<span class="stringliteral">        headerLength -= 4</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&nbsp;<span class="stringliteral">        CSPName = stm.read(headerLength)</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&nbsp;<span class="stringliteral">        provider = CSPName.decode('utf-16').lower()</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&nbsp;<span class="stringliteral">        # Encryption verifier</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&nbsp;<span class="stringliteral">        saltSize = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&nbsp;<span class="stringliteral">        assert(saltSize == 16)</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&nbsp;<span class="stringliteral">        salt = stm.read(saltSize)</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&nbsp;<span class="stringliteral">        encryptedVerifier = stm.read(16)</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&nbsp;<span class="stringliteral">        verifierHashSize = unpack("&lt;I", stm.read(4))[0]</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&nbsp;<span class="stringliteral">        encryptedVerifierHash = stm.read(verifierHashSize)</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&nbsp;<span class="stringliteral">        sys.stdout.write("%s:$office$*%d*%d*%d*%d*%s*%s*%s\n" % \</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&nbsp;<span class="stringliteral">            (os.path.basename(filename), 2007, verifierHashSize,</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&nbsp;<span class="stringliteral">             keySize, saltSize, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&nbsp;<span class="stringliteral">            binascii.hexlify(encryptedVerifier).decode("ascii"),</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&nbsp;<span class="stringliteral">            binascii.hexlify(encryptedVerifierHash)[0:64].decode("ascii")))</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01883"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a080c0481ad616f1309a7d82f3f88da84"> 1883</a></span>&nbsp;<span class="stringliteral">have_summary = False</span></div><div class="line"><a name="l01884"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2b68d0bc8caef07ba4a2c73955516de6"> 1884</a></span>&nbsp;<span class="stringliteral">summary = []</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&nbsp;<span class="stringliteral">import re</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&nbsp;<span class="stringliteral">import string</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01890"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a95b28320bc5c457a06dcf1334440d11e"> 1890</a></span>&nbsp;<span class="stringliteral">def remove_html_tags(data):</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&nbsp;<span class="stringliteral">    p = re.compile(r'&lt;.*?&gt;', re.DOTALL)</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&nbsp;<span class="stringliteral">    return p.sub('', str(data))</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01895"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af9d7370d05bc06ea634da645462a2fd0"> 1895</a></span>&nbsp;<span class="stringliteral">def remove_extra_spaces(data):</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&nbsp;<span class="stringliteral">    p = re.compile(r'\s+')</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&nbsp;<span class="stringliteral">    return p.sub(' ', data)</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01900"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac17142ea33cc3993cf79fc1d1306d935"> 1900</a></span>&nbsp;<span class="stringliteral">def process_file(filename):</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&nbsp;<span class="stringliteral">    # Test if a file is an OLE container:</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&nbsp;<span class="stringliteral">    try:</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&nbsp;<span class="stringliteral">        f = open(filename, "rb")</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&nbsp;<span class="stringliteral">        if f.read(2) == b"PK":</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&nbsp;<span class="stringliteral">            sys.stderr.write("%s : zip container found, file is " \</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&nbsp;<span class="stringliteral">                        "unencrypted?, invalid OLE file!\n" % filename)</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&nbsp;<span class="stringliteral">            f.close()</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&nbsp;<span class="stringliteral">            return 1</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&nbsp;<span class="stringliteral">        f.close()</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&nbsp;<span class="stringliteral">        if not isOleFile(filename):</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&nbsp;<span class="stringliteral">            sys.stderr.write("%s : Invalid OLE file\n" % filename)</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&nbsp;<span class="stringliteral">            return 1</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&nbsp;<span class="stringliteral">    except Exception:</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&nbsp;<span class="stringliteral">        e = sys.exc_info()[1]</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&nbsp;<span class="stringliteral">        import traceback</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&nbsp;<span class="stringliteral">        traceback.print_exc()</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : OLE check failed, %s\n" % (filename, str(e)))</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&nbsp;<span class="stringliteral">        return 2</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&nbsp;<span class="stringliteral">    # Open OLE file:</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&nbsp;<span class="stringliteral">    ole = OleFileIO(filename)</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&nbsp;<span class="stringliteral">    stream = None</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&nbsp;<span class="stringliteral">    # find "summary" streams</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&nbsp;<span class="stringliteral">    global have_summary, summary</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&nbsp;<span class="stringliteral">    have_summary = False</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&nbsp;<span class="stringliteral">    summary = []</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&nbsp;<span class="stringliteral">    for streamname in ole.listdir():</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&nbsp;<span class="stringliteral">        streamname = streamname[-1]</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&nbsp;<span class="stringliteral">        if streamname[0] == "\005":</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&nbsp;<span class="stringliteral">            have_summary = True</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&nbsp;<span class="stringliteral">            props = ole.getproperties(streamname)</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&nbsp;<span class="stringliteral">            for k, v in props.items():</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&nbsp;<span class="stringliteral">                if v is None:</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&nbsp;<span class="stringliteral">                    continue</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&nbsp;<span class="stringliteral">                if not PY3:</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&nbsp;<span class="stringliteral">                    if not isinstance(v, unicode): # We are only interested in strings</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&nbsp;<span class="stringliteral">                        continue</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&nbsp;<span class="stringliteral">                else:</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&nbsp;<span class="stringliteral">                    if not isinstance(v, str): # We are only interested in strings</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&nbsp;<span class="stringliteral">                        continue</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&nbsp;<span class="stringliteral">                v = remove_html_tags(v)</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&nbsp;<span class="stringliteral">                v = v.replace(":", "")</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&nbsp;<span class="stringliteral">                v = remove_extra_spaces(v)</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&nbsp;<span class="stringliteral">                #words = v.split()</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&nbsp;<span class="stringliteral">                #words = filter(lambda x: len(x) &lt; 20, words)</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&nbsp;<span class="stringliteral">                #v = " ".join(words)</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&nbsp;<span class="stringliteral">                summary.append(v)</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&nbsp;<span class="stringliteral">    summary = " ".join(summary)</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&nbsp;<span class="stringliteral">    summary = remove_extra_spaces(summary)</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&nbsp;<span class="stringliteral">    if ["EncryptionInfo"] in ole.listdir():</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&nbsp;<span class="stringliteral">        # process Office 2003 / 2010 / 2013 files</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&nbsp;<span class="stringliteral">        return process_new_office(filename)</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&nbsp;<span class="stringliteral">    if ["Workbook"] in ole.listdir():</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&nbsp;<span class="stringliteral">        stream = "Workbook"</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&nbsp;<span class="stringliteral">    elif ["WordDocument"] in ole.listdir():</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&nbsp;<span class="stringliteral">        stream = "1Table"</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&nbsp;<span class="stringliteral">    elif ["PowerPoint Document"] in ole.listdir():</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&nbsp;<span class="stringliteral">        stream = "Current User"</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : No supported streams found\n" % filename)</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&nbsp;<span class="stringliteral">        return 2</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&nbsp;<span class="stringliteral">    try:</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&nbsp;<span class="stringliteral">        workbookStream = ole.openstream(stream)</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&nbsp;<span class="stringliteral">    except:</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&nbsp;<span class="stringliteral">        import traceback</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&nbsp;<span class="stringliteral">        traceback.print_exc()</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : stream %s not found!\n" % (filename, stream))</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&nbsp;<span class="stringliteral">        return 2</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&nbsp;<span class="stringliteral">    if workbookStream is None:</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&nbsp;<span class="stringliteral">        sys.stderr.write("%s : Error opening stream, %s\n" % filename)</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&nbsp;<span class="stringliteral">        (filename, stream)</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&nbsp;<span class="stringliteral">        return 3</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&nbsp;<span class="stringliteral">    if stream == "Workbook":</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&nbsp;<span class="stringliteral">        typ = 0</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&nbsp;<span class="stringliteral">        passinfo = find_rc4_passinfo_xls(filename, workbookStream)</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&nbsp;<span class="stringliteral">        if passinfo is None:</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&nbsp;<span class="stringliteral">            return 4</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&nbsp;<span class="stringliteral">    elif stream == "1Table":</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&nbsp;<span class="stringliteral">        typ = 1</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&nbsp;<span class="stringliteral">        sdoc = ole.openstream("WordDocument")</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&nbsp;<span class="stringliteral">        ret = find_doc_type(filename, sdoc)</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&nbsp;<span class="stringliteral">        if not ret:</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&nbsp;<span class="stringliteral">            passinfo = find_rc4_passinfo_doc(filename, workbookStream)</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&nbsp;<span class="stringliteral">            if passinfo is None:</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&nbsp;<span class="stringliteral">                return 4</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&nbsp;<span class="stringliteral">        else:</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&nbsp;<span class="stringliteral">            return 5</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&nbsp;<span class="stringliteral">        sppt = ole.openstream("Current User")</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&nbsp;<span class="stringliteral">        offset = find_ppt_type(filename, sppt)</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&nbsp;<span class="stringliteral">        sppt = ole.openstream("PowerPoint Document")</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&nbsp;<span class="stringliteral">        find_rc4_passinfo_ppt(filename, sppt, offset)</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&nbsp;<span class="stringliteral">        return 6</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&nbsp;<span class="stringliteral">    (salt, verifier, verifierHash) = passinfo</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&nbsp;<span class="stringliteral">    if not have_summary:</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&nbsp;<span class="stringliteral">        sys.stdout.write("%s:$oldoffice$%s*%s*%s*%s\n" % (os.path.basename(filename),</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&nbsp;<span class="stringliteral">            typ, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&nbsp;<span class="stringliteral">            binascii.hexlify(verifier).decode("ascii"),</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&nbsp;<span class="stringliteral">            binascii.hexlify(verifierHash).decode("ascii")))</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&nbsp;<span class="stringliteral">        sys.stdout.write("%s:$oldoffice$%s*%s*%s*%s:::%s::%s\n" % (os.path.basename(filename),</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&nbsp;<span class="stringliteral">            typ, binascii.hexlify(salt).decode("ascii"),</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&nbsp;<span class="stringliteral">            binascii.hexlify(verifier).decode("ascii"),</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&nbsp;<span class="stringliteral">            binascii.hexlify(verifierHash).decode("ascii"),</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&nbsp;<span class="stringliteral">            summary, filename))</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&nbsp;<span class="stringliteral">    workbookStream.close()</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&nbsp;<span class="stringliteral">    ole.close()</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&nbsp;<span class="stringliteral">    return 0</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&nbsp;<span class="stringliteral">if __name__ == "__main__":</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&nbsp;<span class="stringliteral">    if len(sys.argv) &lt; 2:</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&nbsp;<span class="stringliteral">        sys.stderr.write("Usage: %s &lt;encrypted Office file(s)&gt;\n" % sys.argv[0])</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&nbsp;<span class="stringliteral">        sys.exit(1)</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&nbsp;<span class="stringliteral">#set_debug_mode(1)</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&nbsp;<span class="stringliteral"></span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&nbsp;<span class="stringliteral">for i in range(1, len(sys.argv)):</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&nbsp;<span class="stringliteral">    if not PY3:</span></div><div class="line"><a name="l02031"></a><span class="lineno"><a class="line" href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a91730971bce437f5b63a93aebd56da9a"> 2031</a></span>&nbsp;<span class="stringliteral">        ret = process_file(sys.argv[i].decode("utf8"))</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&nbsp;<span class="stringliteral">    else:</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&nbsp;<span class="stringliteral">        ret = process_file(sys.argv[i])</span></div><span class="stringliteral"><div class="ttc" id="namespaceoffice2john_html_ac5189f5eda6f15da77ce92e9a44d7c0d"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac5189f5eda6f15da77ce92e9a44d7c0d">office2john._find</a></div><div class="ttdeci">def _find(self, filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01326">office2john.py:1326</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_af0b16284c9edeff57927a705694d76f7"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af0b16284c9edeff57927a705694d76f7">office2john.debug_print</a></div><div class="ttdeci">def debug_print(msg)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00243">office2john.py:243</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_ac047fb25c0e99442f3d44fead84ae262"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ac047fb25c0e99442f3d44fead84ae262">office2john._OleDirectoryEntry.name</a></div><div class="ttdeci">name</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00637">office2john.py:637</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a6b7c610ef20c4f95cb14d61942df3beb"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a6b7c610ef20c4f95cb14d61942df3beb">office2john.get_type</a></div><div class="ttdeci">def get_type(self, filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01375">office2john.py:1375</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a8b79f0bd91baf3143c2401b0c6c6bb1c"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a8b79f0bd91baf3143c2401b0c6c6bb1c">office2john.openstream</a></div><div class="ttdeci">def openstream(self, filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01356">office2john.py:1356</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_ab2030c99da115320b58a319d1a47be7c"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ab2030c99da115320b58a319d1a47be7c">office2john.OleFileIO.__init__</a></div><div class="ttdeci">def __init__(self, filename=None, raise_defects=DEFECT_FATAL)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00786">office2john.py:786</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a3d111eeff9847192161501264c6b0a22"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a3d111eeff9847192161501264c6b0a22">office2john.get_size</a></div><div class="ttdeci">def get_size(self, filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01409">office2john.py:1409</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a32db4053d07a95313039b9eab1bfd3f7"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a32db4053d07a95313039b9eab1bfd3f7">office2john.getsect</a></div><div class="ttdeci">def getsect(self, sect)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01177">office2john.py:1177</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_ac55583c6f72a9e618c0af0ac7fb5ea7f"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ac55583c6f72a9e618c0af0ac7fb5ea7f">office2john.get_rootentry_name</a></div><div class="ttdeci">def get_rootentry_name(self)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01425">office2john.py:1425</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_af9db833d09a1f77935bf99683a990ba0"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9db833d09a1f77935bf99683a990ba0">office2john.OleFileIO.minisectorcutoff</a></div><div class="ttdeci">minisectorcutoff</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00977">office2john.py:977</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a00459a74c4f6f514cd22ee6f9887e37f"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a00459a74c4f6f514cd22ee6f9887e37f">office2john._clsid</a></div><div class="ttdeci">def _clsid(clsid)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00356">office2john.py:356</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a333e3b3dd02b5516713781bfbe50e3d6"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a333e3b3dd02b5516713781bfbe50e3d6">office2john.i32</a></div><div class="ttdeci">def i32(c, o=0)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00343">office2john.py:343</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a3167fe801afa969e82b6dd0e16bd026f"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3167fe801afa969e82b6dd0e16bd026f">office2john._OleDirectoryEntry.append_kids</a></div><div class="ttdeci">def append_kids(self, child_sid)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00700">office2john.py:700</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_ab285e78156be2b21577da978eb3f5488"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#ab285e78156be2b21577da978eb3f5488">office2john.debug</a></div><div class="ttdeci">def debug</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00247">office2john.py:247</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleStream_html"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html">office2john._OleStream</a></div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00417">office2john.py:417</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_af71cca412245531b86fe23766234c24c"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af71cca412245531b86fe23766234c24c">office2john.OleFileIO.sect2array</a></div><div class="ttdeci">def sect2array(self, sect)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01030">office2john.py:1030</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a1becfc0f80107df104ea0bcc9534e2de"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a1becfc0f80107df104ea0bcc9534e2de">office2john._list</a></div><div class="ttdeci">def _list(self, files, prefix, node)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01302">office2john.py:1302</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a663c091f9c2e3bfe7c57a0a3609b88c6"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a663c091f9c2e3bfe7c57a0a3609b88c6">office2john.OleFileIO.close</a></div><div class="ttdeci">def close(self)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00998">office2john.py:998</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a9eb650a66fda280eefaec5cc01e7ea10"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a9eb650a66fda280eefaec5cc01e7ea10">office2john.debug_pass</a></div><div class="ttdeci">def debug_pass(msg)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00245">office2john.py:245</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_aa97469bb83aa32c9421b7645521abf9b"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aa97469bb83aa32c9421b7645521abf9b">office2john.OleFileIO.DllVersion</a></div><div class="ttdeci">DllVersion</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00943">office2john.py:943</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_aa881d22e1178a8ba147968205d8f782c"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#aa881d22e1178a8ba147968205d8f782c">office2john._OleDirectoryEntry.used</a></div><div class="ttdeci">used</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00602">office2john.py:602</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_afa01a92e9b525b6ee620b4ee2dd4cdf3"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#afa01a92e9b525b6ee620b4ee2dd4cdf3">office2john.OleFileIO.fp</a></div><div class="ttdeci">fp</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00829">office2john.py:829</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a57edc1712203ce3ad923d86d5408fa70"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a57edc1712203ce3ad923d86d5408fa70">office2john.OleFileIO.SectorSize</a></div><div class="ttdeci">SectorSize</div><div class="ttdoc">Header struct StructuredStorageHeader { // [offset from start (bytes), length (bytes)] BYTE _abSig[8]...</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00939">office2john.py:939</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a763261d9435a624c49346f6c49cd0656"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a763261d9435a624c49346f6c49cd0656">office2john.exists</a></div><div class="ttdeci">def exists(self, filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01394">office2john.py:1394</a></div></div>
<div class="ttc" id="namespaceml2john_html_a8e9e260274be9b9735a547485266df24"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceml2john.html#a8e9e260274be9b9735a547485266df24">ml2john.StringIO</a></div><div class="ttdeci">StringIO</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/ml2john_8py_source.html#l00293">ml2john.py:293</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_ac0e91fa98f715574b1ad3e31c7e54f79"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ac0e91fa98f715574b1ad3e31c7e54f79">office2john.OleFileIO._filesize</a></div><div class="ttdeci">_filesize</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00848">office2john.py:848</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a1045ff760bdd40a5248ed1d64caa48ed"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a1045ff760bdd40a5248ed1d64caa48ed">office2john._OleDirectoryEntry.__init__</a></div><div class="ttdeci">def __init__(self, entry, sid, olefile)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00581">office2john.py:581</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_adb15ece05dc5f39c176c4f8b1a85f6e7"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#adb15ece05dc5f39c176c4f8b1a85f6e7">office2john.OleFileIO.minifatsect</a></div><div class="ttdeci">minifatsect</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00995">office2john.py:995</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a3f18102064aa23faccf4f2b69b5f92c1"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a3f18102064aa23faccf4f2b69b5f92c1">office2john.dumpdirectory</a></div><div class="ttdeci">def dumpdirectory(self)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01261">office2john.py:1261</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a1e73b962367d370f9d965311a5b386cd"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a1e73b962367d370f9d965311a5b386cd">office2john.OleFileIO.nb_sect</a></div><div class="ttdeci">nb_sect</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00970">office2john.py:970</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_adf25fd6006038fb5011fe6885ee27721"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#adf25fd6006038fb5011fe6885ee27721">office2john.loaddirectory</a></div><div class="ttdeci">def loaddirectory(self, sect)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01202">office2john.py:1202</a></div></div>
<div class="ttc" id="weird__another__fmt__plug_8c_html_ac95378190d8b79ac8ef51d60628a268a"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/weird__another__fmt__plug_8c.html#ac95378190d8b79ac8ef51d60628a268a">map</a></div><div class="ttdeci">unsigned char map[256][33]</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/weird__another__fmt__plug_8c_source.html#l00046">weird_another_fmt_plug.c:46</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a03c0a0291f52aff1413db5bbd5e7cef3"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a03c0a0291f52aff1413db5bbd5e7cef3">office2john._open</a></div><div class="ttdeci">def _open(self, start, size=0x7FFFFFFF, force_FAT=False)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01268">office2john.py:1268</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html">office2john.OleFileIO</a></div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00757">office2john.py:757</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a0d29d4f550cd5ca3627fbb90d730c2e6"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a0d29d4f550cd5ca3627fbb90d730c2e6">office2john._OleDirectoryEntry.__cmp__</a></div><div class="ttdeci">def __cmp__(self, other)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00747">office2john.py:747</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a7ddb312b2ddbd9c2e57ecada64bc7b03"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7ddb312b2ddbd9c2e57ecada64bc7b03">office2john.OleFileIO.sectorsize</a></div><div class="ttdeci">sectorsize</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00975">office2john.py:975</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a2fd80ff7719c7e43afd9612a1396c3ac"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a2fd80ff7719c7e43afd9612a1396c3ac">office2john.OleFileIO.minisectorsize</a></div><div class="ttdeci">minisectorsize</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00976">office2john.py:976</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_af9b68be3a6363db728b452d1a7e09ac9"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af9b68be3a6363db728b452d1a7e09ac9">office2john.OleFileIO._check_duplicate_stream</a></div><div class="ttdeci">def _check_duplicate_stream(self, first_sect, minifat=False)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01005">office2john.py:1005</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a2bc9e9e28b19d623e7e9e97472d937f9"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a2bc9e9e28b19d623e7e9e97472d937f9">office2john.listdir</a></div><div class="ttdeci">def listdir(self)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01317">office2john.py:1317</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a10f76c07f25d3f78e4897def69b4f340"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a10f76c07f25d3f78e4897def69b4f340">office2john._OleDirectoryEntry.kids</a></div><div class="ttdeci">kids</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00595">office2john.py:595</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a4a5c7ee413fab8eb685b5038636bf3b6"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a4a5c7ee413fab8eb685b5038636bf3b6">office2john._OleDirectoryEntry.olefile</a></div><div class="ttdeci">olefile</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00592">office2john.py:592</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_afc1397de1a90cd05b5ef70694cf6c4d0"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#afc1397de1a90cd05b5ef70694cf6c4d0">office2john.set_debug_mode</a></div><div class="ttdeci">def set_debug_mode(debug_mode)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00249">office2john.py:249</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a4cbbcb333e7d637d2ac89ec48162d968"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a4cbbcb333e7d637d2ac89ec48162d968">office2john.OleFileIO._used_streams_fat</a></div><div class="ttdeci">_used_streams_fat</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00852">office2john.py:852</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_ade2546a20232bf24d38aff58204c3303"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ade2546a20232bf24d38aff58204c3303">office2john._OleDirectoryEntry.sid</a></div><div class="ttdeci">sid</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00590">office2john.py:590</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a05cd0f79d88db350368ea3a3cd84253e"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a05cd0f79d88db350368ea3a3cd84253e">office2john._OleDirectoryEntry.kids_dict</a></div><div class="ttdeci">kids_dict</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00599">office2john.py:599</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a5bf2d8a5129348e6dc222542f0ed9aa6"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5bf2d8a5129348e6dc222542f0ed9aa6">office2john.OleFileIO.fat</a></div><div class="ttdeci">fat</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01067">office2john.py:1067</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a7f15bc1125c99e0025038e0b0e038ac6"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a7f15bc1125c99e0025038e0b0e038ac6">office2john.OleFileIO._raise_defect</a></div><div class="ttdeci">def _raise_defect(self, defect_level, message)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00800">office2john.py:800</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a600481e940d2d6d66326e34b7068ddc4"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a600481e940d2d6d66326e34b7068ddc4">office2john.OleFileIO.loadfat</a></div><div class="ttdeci">def loadfat(self, header)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01071">office2john.py:1071</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a74f12a8595f3e23247875cc3f44640ba"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a74f12a8595f3e23247875cc3f44640ba">office2john.OleFileIO.loadfat_sect</a></div><div class="ttdeci">def loadfat_sect(self, sect)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01042">office2john.py:1042</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a507ce75696f13b9510cd886cbef7ff69"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a507ce75696f13b9510cd886cbef7ff69">office2john._OleDirectoryEntry.build_storage_tree</a></div><div class="ttdeci">def build_storage_tree(self)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00676">office2john.py:676</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html">office2john._OleDirectoryEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00551">office2john.py:551</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_abf70dfa4ce35d150a185f4ba8e5c1a38"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#abf70dfa4ce35d150a185f4ba8e5c1a38">office2john.OleFileIO._raise_defects_level</a></div><div class="ttdeci">_raise_defects_level</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00795">office2john.py:795</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a45a0bd5a6df12d5abc3ad3c866411705"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a45a0bd5a6df12d5abc3ad3c866411705">office2john._load_direntry</a></div><div class="ttdeci">def _load_direntry(self, sid)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01237">office2john.py:1237</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_aff6c4f589be1e76dfb22bf56a84c38ab"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#aff6c4f589be1e76dfb22bf56a84c38ab">office2john.OleFileIO.MiniSectorSize</a></div><div class="ttdeci">MiniSectorSize</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00946">office2john.py:946</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_af4eb965a4f87980b47523e8a816fff2e"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#af4eb965a4f87980b47523e8a816fff2e">office2john.loadminifat</a></div><div class="ttdeci">def loadminifat(self)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l01143">office2john.py:1143</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a29c4cf0d99d984c6d6d580fdb33e29ac"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a29c4cf0d99d984c6d6d580fdb33e29ac">office2john._unicode</a></div><div class="ttdeci">def _unicode(s, errors='replace')</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00398">office2john.py:398</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_ad568d426eedc14ba3b447341c8b9bbaa"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#ad568d426eedc14ba3b447341c8b9bbaa">office2john.OleFileIO._used_streams_minifat</a></div><div class="ttdeci">_used_streams_minifat</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00853">office2john.py:853</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_a82e31e7881340f7f382bf4ad227077de"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#a82e31e7881340f7f382bf4ad227077de">office2john.isOleFile</a></div><div class="ttdeci">def isOleFile(filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00316">office2john.py:316</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_af8cba11a47c45d643f2e4da58bfee60a"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#af8cba11a47c45d643f2e4da58bfee60a">office2john.OleFileIO.open</a></div><div class="ttdeci">def open(self, filename)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00818">office2john.py:818</a></div></div>
<div class="ttc" id="gpg2john_8c_html_ae9081ab6a16fd7c562b43c47a994be36"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/gpg2john_8c.html#ae9081ab6a16fd7c562b43c47a994be36">dump</a></div><div class="ttdeci">public void dump(int)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/gpg2john_8c_source.html#l00381">gpg2john.c:381</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_a3cd61b80103650159e4641976096ef44"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#a3cd61b80103650159e4641976096ef44">office2john._OleDirectoryEntry.entry_type</a></div><div class="ttdeci">entry_type</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00623">office2john.py:623</a></div></div>
<div class="ttc" id="classoffice2john_1_1OleFileIO_html_a5ca8fd60ea1f971e3f963fce5fd78cee"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1OleFileIO.html#a5ca8fd60ea1f971e3f963fce5fd78cee">office2john.OleFileIO.ministream</a></div><div class="ttdeci">ministream</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00994">office2john.py:994</a></div></div>
<div class="ttc" id="namespaceoffice2john_html_aeec9fd188c4676ba88a40d511f766d30"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/namespaceoffice2john.html#aeec9fd188c4676ba88a40d511f766d30">office2john.i16</a></div><div class="ttdeci">def i16(c, o=0)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00331">office2john.py:331</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleDirectoryEntry_html_ae8d803d864d366cdf12ac10a11db46dc"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleDirectoryEntry.html#ae8d803d864d366cdf12ac10a11db46dc">office2john._OleDirectoryEntry.size</a></div><div class="ttdeci">size</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00654">office2john.py:654</a></div></div>
<div class="ttc" id="classoffice2john_1_1__OleStream_html_a0ec1cd49dd03f32b008d1b328dbcab49"><div class="ttname"><a href="https://fossies.org/dox/john-1.8.0-jumbo-1/classoffice2john_1_1__OleStream.html#a0ec1cd49dd03f32b008d1b328dbcab49">office2john._OleStream.__init__</a></div><div class="ttdeci">def __init__(self, fp, sect, size, offset, sectorsize, fat, filesize)</div><div class="ttdef"><b>Definition:</b> <a href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py_source.html#l00437">office2john.py:437</a></div></div>
</span></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="https://fossies.org/dox/john-1.8.0-jumbo-1/dir_a306b7cc5167c29e131a00bfce4c6187.html">run</a></li><li class="navelem"><a class="el" href="https://fossies.org/dox/john-1.8.0-jumbo-1/office2john_8py.html">office2john.py</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="./john_ run_office2john.py Source File - doxygen documentation _ Fossies Dox_files/doxygen.png" alt="doxygen"></a> 1.8.14 </li>
  </ul>
</div>


<div id="powerTip"></div></body></html>